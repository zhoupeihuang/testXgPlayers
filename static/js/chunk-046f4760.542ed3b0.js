(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-046f4760"],{"2cd3":function(e,t,r){"use strict";var n=r("b28d");r.d(t,"a",(function(){return n}))},"757b":function(e,t,r){"use strict";r.r(t);var n=r("7a23");const i=Object(n["e"])("div",{id:"mmid"},null,-1);function a(e,t,r,a,o,s){return Object(n["q"])(),Object(n["d"])("div",null,[Object(n["f"])(" 像我这样的人 "),i])}var o=r("b908");function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){v(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(){c=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(O){u=function(e,t,r){return e[t]=r}}function l(e,t,r,i){var a=t&&t.prototype instanceof f?t:f,o=Object.create(a.prototype),s=new x(i||[]);return n(o,"_invoke",{value:k(e,r,s)}),o}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(O){return{type:"throw",arg:O}}}e.wrap=l;var d={};function f(){}function p(){}function v(){}var _={};u(_,a,(function(){return this}));var y=Object.getPrototypeOf,m=y&&y(y(A([])));m&&m!==t&&r.call(m,a)&&(_=m);var g=v.prototype=f.prototype=Object.create(_);function b(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function i(n,a,o,s){var u=h(e[n],e,a);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==typeof l&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){i("next",e,o,s)}),(function(e){i("throw",e,o,s)})):t.resolve(l).then((function(e){c.value=e,o(c)}),(function(e){return i("throw",e,o,s)}))}s(u.arg)}var a;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){i(e,r,t,n)}))}return a=a?a.then(n,n):n()}})}function k(e,t,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return D()}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=w(o,r);if(s){if(s===d)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=h(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function w(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),d;var i=h(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,d;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function A(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:D}}function D(){return{value:void 0,done:!0}}return p.prototype=v,n(g,"constructor",{value:v,configurable:!0}),n(v,"constructor",{value:p,configurable:!0}),p.displayName=u(v,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,u(e,s,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},b(E.prototype),u(E.prototype,o,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new E(l(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},b(g),u(g,s,"Generator"),u(g,a,(function(){return this})),u(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=A,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;T(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:A(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},e}function l(e,t,r,n,i,a,o){try{var s=e[a](o),u=s.value}catch(c){return void r(c)}s.done?t(u):Promise.resolve(u).then(n,i)}function h(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){l(a,n,i,o,s,"next",e)}function s(e){l(a,n,i,o,s,"throw",e)}o(void 0)}))}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,S(n.key),n)}}function p(e,t,r){return t&&f(e.prototype,t),r&&f(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function v(e,t,r){return t=S(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&m(e,t)}function y(e){return y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},y(e)}function m(e,t){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},m(e,t)}function g(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function E(e,t){if(t&&("object"===typeof t||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return b(e)}function k(e){var t=g();return function(){var r,n=y(e);if(t){var i=y(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return E(this,r)}}function w(e,t){if("object"!==typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function S(e){var t=w(e,"string");return"symbol"===typeof t?t:String(t)}var T=r("2a75"),x=r("2cd3"),A=r("2bdd"),D={ERROR:"error",TTFB:"core.ttfb",LOAD_START:"core.loadstart",LOAD_RESPONSE_HEADERS:"core.loadresponseheaders",LOAD_COMPLETE:"core.loadcomplete",LOAD_RETRY:"core.loadretry",SOURCEBUFFER_CREATED:"core.sourcebuffercreated",ANALYZE_DURATION_EXCEEDED:"core.analyzedurationexceeded",REMOVE_BUFFER:"core.removebuffer",BUFFEREOS:"core.buffereos",KEYFRAME:"core.keyframe",METADATA_PARSED:"core.metadataparsed",SEI:"core.sei",SEI_IN_TIME:"core.seiintime",FLV_SCRIPT_DATA:"core.flvscriptdata",LOWDECODE:"core.lowdecode",SWITCH_URL_SUCCESS:"core.switchurlsuccess",SWITCH_URL_FAILED:"core.switchurlfailed",SPEED:"core.speed",HLS_MANIFEST_LOADED:"core.hlsmanifestloaded",HLS_LEVEL_LOADED:"core.hlslevelloaded",DEMUXED_TRACK:"core.demuxedtrack",STREAM_EXCEPTION:"core.streamexception",LARGE_AV_FIRST_FRAME_GAP_DETECT:"LARGE_AV_FIRST_FRAME_GAP_DETECT",LARGE_VIDEO_DTS_GAP_DETECT:"LARGE_VIDEO_DTS_GAP_DETECT",LARGE_AUDIO_DTS_GAP_DETECT:"LARGE_AUDIO_DTS_GAP_DETECT",AUDIO_GAP_DETECT:"AUDIO_GAP_DETECT",AUDIO_OVERLAP_DETECT:"AUDIO_OVERLAP_DETECT",MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT:"MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT",REAL_TIME_SPEED:"real_time_speed"},O=r("ba10"),R=r.n(O);function L(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function C(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?L(Object(r),!0).forEach((function(t){j(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function P(){P=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(D){u=function(e,t,r){return e[t]=r}}function c(e,t,r,i){var a=t&&t.prototype instanceof d?t:d,o=Object.create(a.prototype),s=new T(i||[]);return n(o,"_invoke",{value:E(e,r,s)}),o}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(D){return{type:"throw",arg:D}}}e.wrap=c;var h={};function d(){}function f(){}function p(){}var v={};u(v,a,(function(){return this}));var _=Object.getPrototypeOf,y=_&&_(_(x([])));y&&y!==t&&r.call(y,a)&&(v=y);var m=p.prototype=d.prototype=Object.create(v);function g(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function i(n,a,o,s){var u=l(e[n],e,a);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==typeof h&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){i("next",e,o,s)}),(function(e){i("throw",e,o,s)})):t.resolve(h).then((function(e){c.value=e,o(c)}),(function(e){return i("throw",e,o,s)}))}s(u.arg)}var a;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){i(e,r,t,n)}))}return a=a?a.then(n,n):n()}})}function E(e,t,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return A()}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=k(o,r);if(s){if(s===h)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=l(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===h)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function k(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var i=l(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,h;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function x(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:A}}function A(){return{value:void 0,done:!0}}return f.prototype=p,n(m,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:f,configurable:!0}),f.displayName=u(p,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,u(e,s,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},g(b.prototype),u(b.prototype,o,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new b(c(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},g(m),u(m,s,"Generator"),u(m,a,(function(){return this})),u(m,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=x,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),S(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;S(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:x(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},e}function U(e){return U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},U(e)}function I(e,t,r,n,i,a,o){try{var s=e[a](o),u=s.value}catch(c){return void r(c)}s.done?t(u):Promise.resolve(u).then(n,i)}function M(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){I(a,n,i,o,s,"next",e)}function s(e){I(a,n,i,o,s,"throw",e)}o(void 0)}))}}function B(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function F(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ae(n.key),n)}}function N(e,t,r){return t&&F(e.prototype,t),r&&F(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function j(e,t,r){return t=ae(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function V(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&H(e,t)}function G(e){return G=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},G(e)}function H(e,t){return H=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},H(e,t)}function z(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function q(e,t,r){return q=z()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var i=Function.bind.apply(e,n),a=new i;return r&&H(a,r.prototype),a},q.apply(null,arguments)}function W(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function K(e){var t="function"===typeof Map?new Map:void 0;return K=function(e){if(null===e||!W(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return q(e,arguments,G(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),H(r,e)},K(e)}function Y(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}function X(e,t){if(null==e)return{};var r,n,i=Y(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function Q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function J(e,t){if(t&&("object"===typeof t||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Q(e)}function Z(e){var t=z();return function(){var r,n=G(e);if(t){var i=G(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return J(this,r)}}function $(e,t){while(!Object.prototype.hasOwnProperty.call(e,t))if(e=G(e),null===e)break;return e}function ee(){return ee="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=$(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},ee.apply(this,arguments)}function te(e,t){if(e){if("string"===typeof e)return re(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?re(e,t):void 0}}function re(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ne(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=te(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function ie(e,t){if("object"!==typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function ae(e){var t=ie(e,"string");return"symbol"===typeof t?t:String(t)}var oe,se={DEBUG:1,LOG:2,WARN:3,ERROR:4},ue=204800,ce=["Boolean","Number","String","Undefined","Null","Date","Object"],le=function(){function e(t,r){B(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]"),e.disabled=(null===r||void 0===r?void 0:r.disabled)||!0,this.logCacheLevel=(null===r||void 0===r?void 0:r.logCacheLevel)||3,this.logMaxSize=(null===r||void 0===r?void 0:r.logMaxSize)||ue,this.logSize=0,this.logTextArray=[]}return N(e,[{key:"debug",value:function(){for(var t,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];this.logCache.apply(this,[se.DEBUG].concat(n)),e.disabled||(t=console).debug.apply(t,[this._prefix,he()].concat(n))}},{key:"log",value:function(){for(var t,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];this.logCache.apply(this,[se.LOG].concat(n)),e.disabled||(t=console).log.apply(t,[this._prefix,he()].concat(n))}},{key:"warn",value:function(){for(var t,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];this.logCache.apply(this,[se.WARN].concat(n)),e.disabled||(t=console).warn.apply(t,[this._prefix,he()].concat(n))}},{key:"error",value:function(){for(var t,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];this.logCache.apply(this,[se.ERROR].concat(n)),e.disabled||(t=console).error.apply(t,[this._prefix,he()].concat(n))}},{key:"logCache",value:function(e){if(!(e<this.logCacheLevel)){var t="";try{for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];var a=n.map((function(e){return fe(e)}));t=this._prefix+he()+JSON.stringify(a)}catch(s){return}if(e>=this.logCacheLevel&&(this.logSize+=t.length,this.logTextArray.push(t)),this.logSize>this.logMaxSize){var o=this.logTextArray.shift();this.logSize-=o.length}}}},{key:"getLogCache",value:function(){var e=this.logTextArray.join("\n");return this.reset(),e}},{key:"reset",value:function(){this.logTextArray=[],this.logSize=0}},{key:"table",value:function(){var t;e.disabled||(t=console).table.apply(t,arguments)}},{key:"setLogLevel",value:function(e){this.logCacheLevel=e}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();function he(){return(new Date).toLocaleString()}function de(e){if("object"!==U(e))return e;var t=Object.prototype.toString.call(e).slice(8,-1);switch(t){case"Array":case"Uint8Array":case"ArrayBuffer":return t+"["+e.length+"]";case"Object":return"{}";default:return t}}function fe(e,t,r){r||(r=1),t||(t=2);var n={};if(!e||"object"!==U(e))return e;var i=Object.prototype.toString.call(e).slice(8,-1);if(!ce.includes(i))return i;if(!(r>t)){for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(r===t?n[a]=de(e[a]):"object"===U(e[a])?n[a]=fe(e[a],t,r+1):n[a]=e[a]);return n}}j(le,"disabled",!0);var pe={MANIFEST:"manifest",NETWORK:"network",NETWORK_TIMEOUT:"network_timeout",NETWORK_FORBIDDEN:"network_forbidden",NETWROK_RANGE_NOT_SATISFIABLE:"network_range_not_satisfiable",DEMUX:"demux",REMUX:"remux",MEDIA:"media",DRM:"drm",OTHER:"other",RUNTIME:"runtime",SUB_TYPES:{FLV:"FLV",HLS:"HLS",MP4:"MP4",FMP4:"FMP4",MSE_ADD_SB:"MSE_ADD_SB",MSE_APPEND_BUFFER:"MSE_APPEND_BUFFER",MSE_OTHER:"MSE_OTHER",MSE_FULL:"MSE_FULL",OPTION:"OPTION",DASH:"DASH",LICENSE:"LICENSE",CUSTOM_LICENSE:"CUSTOM_LICENSE",MSE_HIJACK:"MSE_HIJACK",EME_HIJACK:"EME_HIJACK",SIDX:"SIDX",NO_CANPLAY_ERROR:"NO_CANPLAY_ERROR",BUFFERBREAK_ERROR:"BUFFERBREAK_ERROR",MEDIA_ERR_ABORTED:"MEDIA_ERR_ABORTED",MEDIA_ERR_NETWORK:"MEDIA_ERR_NETWORK",MEDIA_ERR_DECODE:"MEDIA_ERR_DECODE",MEDIA_ERR_SRC_NOT_SUPPORTED:"MEDIA_ERR_SRC_NOT_SUPPORTED",MEDIA_ERR_CODEC_NOT_SUPPORTED:"MEDIA_ERR_CODEC_NOT_SUPPORTED",MEDIA_ERR_URL_EMPTY:"MEDIA_ERR_URL_EMPTY"}},ve=(oe={},j(oe,pe.MANIFEST,{HLS:1100,DASH:1200}),j(oe,pe.NETWORK,2100),j(oe,pe.NETWORK_TIMEOUT,2101),j(oe,pe.NETWORK_FORBIDDEN,2103),j(oe,pe.NETWROK_RANGE_NOT_SATISFIABLE,2116),j(oe,pe.DEMUX,{FLV:3100,HLS:3200,MP4:3300,FMP4:3400,SIDX:3410}),j(oe,pe.REMUX,{FMP4:4100,MP4:4200}),j(oe,pe.MEDIA,{MEDIA_ERR_ABORTED:5101,MEDIA_ERR_NETWORK:5102,MEDIA_ERR_DECODE:5103,MEDIA_ERR_SRC_NOT_SUPPORTED:5104,MEDIA_ERR_CODEC_NOT_SUPPORTED:5105,MEDIA_ERR_URL_EMPTY:5106,MSE_ADD_SB:5200,MSE_APPEND_BUFFER:5201,MSE_OTHER:5202,MSE_FULL:5203,MSE_HIJACK:5204,EME_HIJACK:5301}),j(oe,pe.DRM,{LICENSE:7100,CUSTOM_LICENSE:7200}),j(oe,pe.OTHER,8e3),j(oe,pe.RUNTIME,{NO_CANPLAY_ERROR:9001,BUFFERBREAK_ERROR:9002}),oe),_e=function(e){V(r,e);var t=Z(r);function r(e,n,i,a,o){var s;return B(this,r),s=t.call(this,o||(null===i||void 0===i?void 0:i.message)),s.errorType=e===pe.NETWORK_TIMEOUT?pe.NETWORK:e,s.originError=i,s.ext=a,s.errorCode=ve[e][n]||ve[e],s.errorMessage=s.message,s.errorCode||(s.errorType=pe.OTHER,s.errorCode=ve[s.errorType]),s}return N(r,null,[{key:"create",value:function(e,t,n,i,a){return e instanceof r?e:(e instanceof Error&&(n=e,e=""),e||(e=pe.OTHER),new r(e,t,n,i,a))}},{key:"network",value:function(e){var t;return new r(null!==e&&void 0!==e&&e.isTimeout?pe.NETWORK_TIMEOUT:pe.NETWORK,null,e instanceof Error?e:null,{url:null===e||void 0===e?void 0:e.url,response:null===e||void 0===e?void 0:e.response,httpCode:null===e||void 0===e||null===(t=e.response)||void 0===t?void 0:t.status})}}]),r}(K(Error)),ye=function(){function e(){B(this,e)}return N(e,null,[{key:"start",value:function(e){return e&&e.length?1===e.length&&e.end(0)-e.start(0)<1e-6||1===e.length&&e.start(0)<0?0:e.start(0):0}},{key:"end",value:function(e){return e&&e.length?1===e.length&&e.end(0)-e.start(0)<1e-6?0:e.end(e.length-1):0}},{key:"get",value:function(e){if(e)try{return e.buffered}catch(t){}}},{key:"buffers",value:function(e,t){if(!e||!e.length)return[];for(var r=[],n=0,i=e.length;n<i;n++){var a=r.length;if(a&&t){var o=r[a-1],s=o[1],u=e.start(n);if(u-s<=t){var c=e.end(n);c>s&&(o[1]=c)}else r.push([e.start(n),e.end(n)])}else r.push([e.start(n),e.end(n)])}return r}},{key:"totalLength",value:function(e){return e&&e.length?e.reduce((function(e,t){return e+(t[1]-t[0])}),0):0}},{key:"info",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!t||!t.length)return{start:0,end:0,buffers:[]};for(var i=0,a=0,o=0,s=0,u=0,c=0,l=0,h=e.buffers(t,n),d=0,f=h.length;d<f;d++){var p=h[d];if(r+n>=p[0]&&r<p[1])i=p[0],a=p[1],o=d;else{if(r+n<p[0]){s=p[0],u=p[1];break}r+n>p[1]&&(c=p[0],l=p[1])}}return{start:i,end:a,index:o,buffers:h,nextStart:s,nextEnd:u,prevStart:c,prevEnd:l,currentTime:r,behind:r-i,remaining:a?a-r:0,length:e.totalLength&&e.totalLength(h)}}}]),e}();function me(e){return e&&!e.paused&&!e.ended&&0!==e.playbackRate&&0!==e.readyState}function ge(e){if(!e)return{};if("function"===typeof e.getVideoPlaybackQuality){var t=e.getVideoPlaybackQuality();return{droppedVideoFrames:t.droppedVideoFrames||t.corruptedVideoFrames,totalVideoFrames:t.totalVideoFrames,creationTime:t.creationTime}}return{droppedVideoFrames:e.webkitDroppedFrameCount,totalVideoFrames:e.webkitDecodedFrameCount,creationTime:performance.now()}}function be(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(t=t.filter(Boolean),t.length<2)return t[0];var n=new Uint8Array(t.reduce((function(e,t){return e+t.byteLength}),0)),i=0;return t.forEach((function(e){n.set(e,i),i+=e.byteLength})),n}function Ee(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(t){return setTimeout(t,e)}))}var ke={FETCH:"fetch",XHR:"xhr"},we={ARRAY_BUFFER:"arraybuffer",TEXT:"text",JSON:"json"},Se=function(e){V(r,e);var t=Z(r);function r(e,n,i,a){var o;return B(this,r),o=t.call(this,a),j(Q(o),"retryCount",0),j(Q(o),"isTimeout",!1),j(Q(o),"loaderType",ke.FETCH),j(Q(o),"startTime",0),j(Q(o),"endTime",0),j(Q(o),"options",{}),o.url=e,o.request=n,o.response=i,o}return N(r)}(K(Error)),Te=Object.prototype.toString;function xe(e){return null!==e&&"object"===U(e)}function Ae(e){if("[object Object]"!==Te.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function De(e){return"[object Date]"===Te.call(e)}function Oe(e){if(e&&null!==e[0]&&void 0!==e[0]&&(0!==e[0]||null!==e[1]&&void 0!==e[1])){var t="bytes="+e[0]+"-";return e[1]&&(t+=e[1]),t}}function Re(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Le(e,t){if(e){if(!t)return e;var r,n=Object.keys(t).map((function(e){if(r=t[e],null!==r&&void 0!==r)return Array.isArray(r)?e+="[]":r=[r],r.map((function(t){return De(t)?t=t.toISOString():xe(t)&&(t=JSON.stringify(t)),"".concat(Re(e),"=").concat(Re(t))})).join("&")})).filter(Boolean).join("&");if(n){var i=e.indexOf("#");-1!==i&&(e=e.slice(0,i)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e}}function Ce(e,t,r,n,i,a,o,s,u,c,l){i=null!==i&&void 0!==i?parseFloat(i):null,n=parseInt(n||"0",10),Number.isNaN(n)&&(n=0);var h={range:u,vid:c,index:s,contentLength:n,age:i,startTime:a,firstByteTime:o,endTime:Date.now(),priOptions:l};return{data:e,done:t,option:h,response:r}}function Pe(e,t){return Math.round(8*e*1e3/t/1024)}var Ue=2097152,Ie=function(e){V(r,e);var t=Z(r);function r(){var e;return B(this,r),e=t.call(this),j(Q(e),"_abortController",null),j(Q(e),"_timeoutTimer",null),j(Q(e),"_reader",null),j(Q(e),"_response",null),j(Q(e),"_aborted",!1),j(Q(e),"_index",-1),j(Q(e),"_range",null),j(Q(e),"_receivedLength",0),j(Q(e),"_running",!1),j(Q(e),"_logger",null),j(Q(e),"_vid",""),j(Q(e),"_onProcessMinLen",0),j(Q(e),"_onCancel",null),j(Q(e),"_priOptions",null),e}return N(r,[{key:"load",value:function(e){var t,r=this,n=e.url,i=e.vid,a=e.timeout,o=e.responseType,s=e.onProgress,u=e.index,c=e.onTimeout,l=e.onCancel,h=e.range,d=e.transformResponse,f=e.request,p=e.params,v=e.logger,_=e.method,y=e.headers,m=e.body,g=e.mode,b=e.credentials,E=e.cache,k=e.redirect,w=e.referrer,S=e.referrerPolicy,T=e.onProcessMinLen,x=e.priOptions;this._logger=v,this._aborted=!1,this._onProcessMinLen=T,this._onCancel=l,this._abortController="undefined"!==typeof AbortController&&new AbortController,this._running=!0,this._index=u,this._range=h||[0,0],this._vid=i||n,this._priOptions=x||{};var A={method:_,headers:y,body:m,mode:g,credentials:b,cache:E,redirect:k,referrer:w,referrerPolicy:S,signal:null===(t=this._abortController)||void 0===t?void 0:t.signal},O=!1;clearTimeout(this._timeoutTimer),n=Le(n,p);var R=Oe(h);R&&(y=f?f.headers:A.headers=A.headers||(Headers?new Headers:{}),Headers&&y instanceof Headers?y.append("Range",R):y.Range=R),a&&(this._timeoutTimer=setTimeout((function(){if(O=!0,r.cancel(),c){var e=new Se(n,A,null,"timeout");e.isTimeout=!0,c(e,{index:r._index,range:r._range,vid:r._vid,priOptions:r._priOptions})}}),a));var L=Date.now();return this._logger.debug("[fetch load start], index,",u,",range,",h),new Promise((function(e,t){fetch(f||n,f?void 0:A).then(function(){var i=M(P().mark((function i(a){var c,l,f,p;return P().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(clearTimeout(r._timeoutTimer),r._response=a,!r._aborted&&r._running){i.next=4;break}return i.abrupt("return");case 4:if(d&&(a=d(a,n)||a),a.ok){i.next=7;break}throw new Se(n,A,a,"bad network response");case 7:if(c=Date.now(),o!==we.TEXT){i.next=15;break}return i.next=11,a.text();case 11:l=i.sent,r._running=!1,i.next=37;break;case 15:if(o!==we.JSON){i.next=22;break}return i.next=18,a.json();case 18:l=i.sent,r._running=!1,i.next=37;break;case 22:if(!s){i.next=29;break}return r.resolve=e,r.reject=t,r._loadChunk(a,s,L,c),i.abrupt("return");case 29:return i.next=31,a.arrayBuffer();case 31:l=i.sent,l=new Uint8Array(l),r._running=!1,f=Date.now()-L,p=Pe(l.byteLength,f),r.emit(D.REAL_TIME_SPEED,{speed:p,len:l.byteLength,time:f,vid:r._vid,index:r._index,range:r._range,priOptions:r._priOptions});case 37:r._logger.debug("[fetch load end], index,",u,",range,",h),e(Ce(l,!0,a,a.headers.get("Content-Length"),a.headers.get("age"),L,c,u,h,r._vid,r._priOptions));case 39:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}()).catch((function(e){var i;clearTimeout(r._timeoutTimer),r._running=!1,r._aborted&&!O||(e=e instanceof Se?e:new Se(n,A,null,null===(i=e)||void 0===i?void 0:i.message),e.startTime=L,e.endTime=Date.now(),e.isTimeout=O,e.options={index:r._index,range:r._range,vid:r._vid,priOptions:r._priOptions},t(e))}))}))}},{key:"cancel",value:function(){var e=M(P().mark((function e(){return P().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this._aborted){e.next=2;break}return e.abrupt("return");case 2:if(this._aborted=!0,this._running=!1,!this._response){e.next=14;break}if(e.prev=5,!this._reader){e.next=9;break}return e.next=9,this._reader.cancel();case 9:e.next=13;break;case 11:e.prev=11,e.t0=e["catch"](5);case 13:this._response=this._reader=null;case 14:if(this._abortController){try{this._abortController.abort()}catch(t){}this._abortController=null}this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions});case 16:case"end":return e.stop()}}),e,this,[[5,11]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"_loadChunk",value:function(e,t,r,n){var i=this;if(!e.body||!e.body.getReader){this._running=!1;var a=new Se(e.url,"",e,"onProgress of bad response.body.getReader");return a.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},void this.reject(a)}this._onProcessMinLen>0&&(this._cache=new Uint8Array(Ue),this._writeIdx=0);var o,s,u,c=this._reader=e.body.getReader(),l=function(){var a=M(P().mark((function a(){var h,d,f,p,v,_,y,m;return P().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return s=Date.now(),a.prev=1,a.next=4,c.read();case 4:o=a.sent,u=Date.now(),a.next=13;break;case 8:return a.prev=8,a.t0=a["catch"](1),u=Date.now(),i._aborted||(i._running=!1,a.t0.options={index:i._index,range:i._range,vid:i._vid,priOptions:i._priOptions},i.reject(a.t0)),a.abrupt("return");case 13:if(d=(null===(h=i._range)||void 0===h?void 0:h.length)>0?i._range[0]:0,f=d+i._receivedLength,!i._aborted){a.next=19;break}return i._running=!1,t(void 0,!1,{range:[f,f],vid:i._vid,index:i._index,startTime:s,endTime:u,st:r,firstByteTime:n,priOptions:i._priOptions},e),a.abrupt("return");case 19:p=o.value?o.value.byteLength:0,i._receivedLength+=p,i._logger.debug("【fetchLoader,onProgress call】,task,",i._range,", start,",f,", end,",d+i._receivedLength,", done,",o.done),i._onProcessMinLen>0?i._writeIdx+p>=i._onProcessMinLen||o.done?(v=new Uint8Array(i._writeIdx+p),v.set(i._cache.slice(0,i._writeIdx),0),p>0&&v.set(o.value,i._writeIdx),i._writeIdx=0,i._logger.debug("【fetchLoader,onProgress enough】,done,",o.done,",len,",v.byteLength,", writeIdx,",i._writeIdx)):p>0&&i._writeIdx+p<Ue?(i._cache.set(o.value,i._writeIdx),i._writeIdx+=p,i._logger.debug("【fetchLoader,onProgress cache】,len,",p,", writeIdx,",i._writeIdx)):p>0&&(_=new Uint8Array(i._writeIdx+p+2048),i._logger.debug("【fetchLoader,onProgress extra start】,size,",i._writeIdx+p+2048,", datalen,",p,", writeIdx,",i._writeIdx),_.set(i._cache.slice(0,i._writeIdx),0),p>0&&_.set(o.value,i._writeIdx),i._writeIdx+=p,delete i._cache,i._cache=_,i._logger.debug("【fetchLoader,onProgress extra end】,len,",p,", writeIdx,",i._writeIdx)):v=o.value,(v&&v.byteLength>0||o.done)&&t(v,o.done,{range:[i._range[0]+i._receivedLength-(v?v.byteLength:0),i._range[0]+i._receivedLength],vid:i._vid,index:i._index,startTime:s,endTime:u,st:r,firstByteTime:n,priOptions:i._priOptions},e),o.done?(y=Date.now()-r,m=Pe(i._receivedLength,y),i.emit(D.REAL_TIME_SPEED,{speed:m,len:i._receivedLength,time:y,vid:i._vid,index:i._index,range:i._range,priOptions:i._priOptions}),i._running=!1,i._logger.debug("[fetchLoader onProgress end],task,",i._range,",done,",o.done),i.resolve(Ce(o,!0,e,e.headers.get("Content-Length"),e.headers.get("age"),r,n,i._index,i._range,i._vid,i._priOptions))):l();case 25:case"end":return a.stop()}}),a,null,[[1,8]])})));return function(){return a.apply(this,arguments)}}();l()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}}],[{key:"isSupported",value:function(){return!("undefined"===typeof fetch)}}]),r}(R.a);function Me(e){return C({loaderType:ke.FETCH,retry:0,retryDelay:0,timeout:0,request:null,onTimeout:void 0,onProgress:void 0,onRetryError:void 0,transformRequest:void 0,transformResponse:void 0,transformError:void 0,responseType:we.TEXT,range:void 0,url:"",params:void 0,method:"GET",headers:{},body:void 0,mode:void 0,credentials:void 0,cache:void 0,redirect:void 0,referrer:void 0,referrerPolicy:void 0,integrity:void 0,onProcessMinLen:0},e)}var Be=function(e){V(r,e);var t=Z(r);function r(){var e;return B(this,r),e=t.call(this),j(Q(e),"_xhr",null),j(Q(e),"_aborted",!1),j(Q(e),"_timeoutTimer",null),j(Q(e),"_range",null),j(Q(e),"_receivedLength",0),j(Q(e),"_url",null),j(Q(e),"_onProgress",null),j(Q(e),"_index",-1),j(Q(e),"_headers",null),j(Q(e),"_currentChunkSizeKB",384),j(Q(e),"_timeout",null),j(Q(e),"_xhr",null),j(Q(e),"_withCredentials",null),j(Q(e),"_startTime",-1),j(Q(e),"_loadCompleteResolve",null),j(Q(e),"_loadCompleteReject",null),j(Q(e),"_runing",!1),j(Q(e),"_logger",!1),j(Q(e),"_vid",""),j(Q(e),"_responseType",void 0),j(Q(e),"_credentials",void 0),j(Q(e),"_method",void 0),j(Q(e),"_transformResponse",void 0),j(Q(e),"_firstRtt",void 0),j(Q(e),"_onCancel",null),j(Q(e),"_priOptions",null),e}return N(r,[{key:"load",value:function(e){var t=this;clearTimeout(this._timeoutTimer),this._logger=e.logger,this._range=e.range,this._onProgress=e.onProgress,this._index=e.index,this._headers=e.headers,this._withCredentials="include"===e.credentials||"same-origin"===e.credentials,this._body=e.body||null,e.method&&(this._method=e.method),this._timeout=e.timeout||null,this._runing=!0,this._vid=e.vid||e.url,this._responseType=e.responseType,this._firstRtt=-1,this._onTimeout=e.onTimeout,this._onCancel=e.onCancel,this._request=e.request,this._priOptions=e.priOptions||{},this._logger.debug("【xhrLoader task】, range",this._range),this._url=Le(e.url,e.params);var r=Date.now();return new Promise((function(e,r){t._loadCompleteResolve=e,t._loadCompleteReject=r,t._startLoad()})).catch((function(e){if(clearTimeout(t._timeoutTimer),t._runing=!1,!t._aborted)throw e=e instanceof Se?e:new Se(t._url,t._request),e.startTime=r,e.endTime=Date.now(),e.options={index:t._index,vid:t._vid,priOptions:t._priOptions},e}))}},{key:"_startLoad",value:function(){var e=null;if(this._responseType===we.ARRAY_BUFFER&&this._range&&this._range.length>1)if(this._onProgress){this._firstRtt=-1;var t=1024*this._currentChunkSizeKB,r=this._range[0]+this._receivedLength,n=this._range[1];t<this._range[1]-r&&(n=r+t),e=[r,n],this._logger.debug("[xhr_loader->],tast :",this._range,", SubRange, ",e)}else e=this._range,this._logger.debug("[xhr_loader->],tast :",this._range,", allRange, ",e);this._internalOpen(e)}},{key:"_internalOpen",value:function(e){var t=this;try{this._startTime=Date.now();var r=this._xhr=new XMLHttpRequest;r.open(this._method||"GET",this._url,!0),r.responseType=this._responseType,this._timeout&&(r.timeout=this._timeout),r.withCredentials=this._withCredentials,r.onload=this._onLoad.bind(this),r.onreadystatechange=this._onReadyStatechange.bind(this),r.onerror=function(e){var r,n,i;t._running=!1;var a=new Se(t._url,t._request,null===e||void 0===e||null===(r=e.currentTarget)||void 0===r?void 0:r.response,"xhr.onerror.status:"+(null===e||void 0===e||null===(n=e.currentTarget)||void 0===n?void 0:n.status)+",statusText,"+(null===e||void 0===e||null===(i=e.currentTarget)||void 0===i?void 0:i.statusText));a.options={index:t._index,range:t._range,vid:t._vid,priOptions:t._priOptions},t._loadCompleteReject(a)},r.ontimeout=function(e){t.cancel();var r=new Se(t._url,t._request,{status:408},"timeout");t._onTimeout&&(r.isTimeout=!0,t._onTimeout(r,{index:t._index,range:t._range,vid:t._vid,priOptions:t._priOptions})),r.options={index:t._index,range:t._range,vid:t._vid,priOptions:t._priOptions},t._loadCompleteReject(r)};var n=this._headers||{},i=Oe(e);i&&(n.Range=i),n&&Object.keys(n).forEach((function(e){r.setRequestHeader(e,n[e])})),this._logger.debug("[xhr.send->] tast,",this._range,",load sub range, ",e),r.send(this._body)}catch(a){a.options={index:this._index,range:e,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(a)}}},{key:"_onReadyStatechange",value:function(e){var t=e.target;2===t.readyState&&this._firstRtt<0&&(this._firstRtt=Date.now())}},{key:"_onLoad",value:function(e){var t,r=e.target.status;if(r<200||r>299){var n=new Se(this._url,null,C(C({},e.target.response),{},{status:r}),"bad response,status:"+r);return n.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(n)}var i,a=null,o=!1,s=(null===(t=this._range)||void 0===t?void 0:t.length)>0?this._range[0]:0;if(this._responseType===we.ARRAY_BUFFER){var u,c=new Uint8Array(e.target.response);if(i=s+this._receivedLength,c&&c.byteLength>0){this._receivedLength+=c.byteLength;var l=Date.now()-this._startTime,h=Pe(this._receivedLength,l);this.emit(D.REAL_TIME_SPEED,{speed:h,len:this._receivedLength,time:l,vid:this._vid,index:this._index,range:[i,s+this._receivedLength],priOptions:this._priOptions})}a=c,o=!((null===(u=this._range)||void 0===u?void 0:u.length)>1&&this._range[1]&&this._receivedLength<this._range[1]-this._range[0]),this._logger.debug("[xhr load done->], tast :",this._range,", start",i,"end ",s+this._receivedLength,",dataLen,",c?c.byteLength:0,",receivedLength",this._receivedLength,",index,",this._index,", done,",o)}else o=!0,a=e.target.response;var d={ok:r>=200&&r<300,status:r,statusText:this._xhr.statusText,url:this._xhr.responseURL,headers:this._getHeaders(this._xhr),body:this._xhr.response};this._transformResponse&&(d=this._transformResponse(d,this._url)||d),this._onProgress&&this._onProgress(a,o,{index:this._index,vid:this._vid,range:[i,s+this._receivedLength],startTime:this._startTime,endTime:Date.now(),priOptions:this._priOptions},d),o?(this._runing=!1,this._loadCompleteResolve&&this._loadCompleteResolve(Ce(this._onProgress?null:a,o,d,d.headers["content-length"],d.headers.age,this._startTime,this._firstRtt,this._index,this._range,this._vid,this._priOptions))):this._startLoad()}},{key:"cancel",value:function(){if(!this._aborted)return this._aborted=!0,this._runing=!1,ee(G(r.prototype),"removeAllListeners",this).call(this),this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions}),this._xhr?this._xhr.abort():void 0}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}},{key:"_getHeaders",value:function(e){var t,r=e.getAllResponseHeaders().trim().split("\r\n"),n={},i=ne(r);try{for(i.s();!(t=i.n()).done;){var a=t.value,o=a.split(": ");n[o[0].toLowerCase()]=o.slice(1).join(": ")}}catch(s){i.e(s)}finally{i.f()}return n}}],[{key:"isSupported",value:function(){return"undefined"!==typeof XMLHttpRequest}}]),r}(R.a);function Fe(){var e,t,r=new Promise((function(r,n){e=r,t=n}));return r.used=!1,r.resolve=function(){return r.used=!0,e.apply(void 0,arguments)},r.reject=function(){return r.used=!0,t.apply(void 0,arguments)},r}function Ne(){try{return parseInt(performance.now(),10)}catch(e){return(new Date).getTime()}}var je=["retry","retryDelay","onRetryError","transformError"],Ve=function(){function e(t,r){B(this,e),this.promise=Fe(),this.alive=!!r.onProgress,!r.logger&&(r.logger=new le("Loader")),this._loaderType=t,this._loader=t===ke.FETCH&&window.fetch?new Ie:new Be,this._config=r,this._retryCount=0,this._retryTimer=null,this._canceled=!1,this._retryCheckFunc=r.retryCheckFunc,this._logger=r.logger}return N(e,[{key:"exec",value:function(){var e=this,t=this._config,r=t.retry,n=t.retryDelay,i=t.onRetryError,a=t.transformError,o=X(t,je),s=function(){var t=M(P().mark((function t(){var u,c,l;return P().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e._loader.load(o);case 3:u=t.sent,e.promise.resolve(u),t.next=27;break;case 7:if(t.prev=7,t.t0=t["catch"](0),e._loader.running=!1,e._logger.debug("[task request catch err]",t.t0),!e._canceled){t.next=13;break}return t.abrupt("return");case 13:if(t.t0.loaderType=e._loaderType,t.t0.retryCount=e._retryCount,c=t.t0,a&&(c=a(c)||c),i&&e._retryCount>0&&i(c,e._retryCount,{index:o.index,vid:o.vid,range:o.range,priOptions:o.priOptions}),e._retryCount++,l=!0,e._retryCheckFunc&&(l=e._retryCheckFunc(t.t0)),!(l&&e._retryCount<=r)){t.next=26;break}return clearTimeout(e._retryTimer),e._logger.debug("[task request setTimeout],retry",e._retryCount,",retry range,",o.range),e._retryTimer=setTimeout(s,n),t.abrupt("return");case 26:e.promise.reject(c);case 27:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(){return t.apply(this,arguments)}}();return s(),this.promise}},{key:"cancel",value:function(){var e=M(P().mark((function e(){return P().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return clearTimeout(this._retryTimer),this._canceled=!0,this._loader.running=!1,e.abrupt("return",this._loader.cancel());case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"running",get:function(){return this._loader&&this._loader.running}},{key:"loader",get:function(){return this._loader}}]),e}(),Ge=function(e){V(r,e);var t=Z(r);function r(e){var n;return B(this,r),n=t.call(this,e),j(Q(n),"type",ke.FETCH),j(Q(n),"_queue",[]),j(Q(n),"_alive",[]),j(Q(n),"_currentTask",null),j(Q(n),"_config",void 0),n._config=Me(e),n._config.loaderType!==ke.XHR&&Ie.isSupported()||(n.type=ke.XHR),n.log=e.logger,n}return N(r,[{key:"isFetch",value:function(){return this.type===ke.FETCH}},{key:"load",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"string"!==typeof e&&e?r=e:r.url=e||r.url||this._config.url,r=Object.assign({},this._config,r),r.params&&(r.params=Object.assign({},r.params)),r.headers&&Ae(r.headers)&&(r.headers=Object.assign({},r.headers)),r.body&&Ae(r.body)&&(r.body=Object.assign({},r.body)),r.transformRequest&&(r=r.transformRequest(r)||r),r.logger=this.log;var n=new Ve(this.type,r);return n.loader.on(D.REAL_TIME_SPEED,(function(e){t.emit(D.REAL_TIME_SPEED,e)})),this._queue.push(n),1!==this._queue.length||this._currentTask&&this._currentTask.running||this._processTask(),n.promise}},{key:"cancel",value:function(){var e=M(P().mark((function e(){var t;return P().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this._queue.map((function(e){return e.cancel()})).concat(this._alive.map((function(e){return e.cancel()}))),this._currentTask&&t.push(this._currentTask.cancel()),this._queue=[],this._alive=[],e.next=6,Promise.all(t);case 6:return e.next=8,Ee();case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"_processTask",value:function(){var e=this;if(this._currentTask=this._queue.shift(),this._currentTask){this._currentTask.alive&&this._alive.push(this._currentTask);var t=this._currentTask.exec().catch((function(e){}));t&&"function"===typeof t.finally&&t.finally((function(){var t,r;null!==(t=e._currentTask)&&void 0!==t&&t.alive&&(null===(r=e._alive)||void 0===r?void 0:r.length)>0&&(e._alive=e._alive.filter((function(t){return t&&t!==e._currentTask}))),e._processTask()}))}}}],[{key:"isFetchSupport",value:function(){return Ie.isSupported()}}]),r}(R.a),He=function(){function e(t){var r=this;B(this,e),j(this,"_seiSet",new Set),this.emitter=t,t.on(D.SEI,(function(e){e&&r._seiSet.add(e)}))}return N(e,[{key:"throw",value:function(e){var t=this;if(null!==e&&void 0!==e&&this._seiSet.size){var r=e-.2,n=e+.2,i=[];this._seiSet.forEach((function(e){e.time>=r&&e.time<=n&&i.push(e)})),i.forEach((function(e){t._seiSet.delete(e),t.emitter.emit(D.SEI_IN_TIME,e)}))}}},{key:"reset",value:function(){this._seiSet.clear()}}]),e}(),ze=function(){function e(){B(this,e),j(this,"_chunkSpeeds",[]),j(this,"_speeds",[])}return N(e,[{key:"addRecord",value:function(e,t){e&&t&&(this._speeds.push(8e3*e/t),this._speeds=this._speeds.slice(-3))}},{key:"addChunkRecord",value:function(e,t){e&&t&&(this._chunkSpeeds.push(8e3*e/t),this._chunkSpeeds=this._chunkSpeeds.slice(-100))}},{key:"getAvgSpeed",value:function(){return this._chunkSpeeds.length||this._speeds.length?this._speeds.length?this._speeds.reduce((function(e,t){return e+t}))/this._speeds.length:this._chunkSpeeds.reduce((function(e,t){return e+t}))/this._chunkSpeeds.length:0}},{key:"getLatestSpeed",value:function(){return this._chunkSpeeds.length||this._speeds.length?this._speeds.length?this._speeds[this._speeds.length-1]:this._chunkSpeeds[this._chunkSpeeds.length-1]:0}},{key:"reset",value:function(){this._chunkSpeeds=[],this._speeds=[]}}]),e}(),qe=function(){function e(t){B(this,e),j(this,"encodeType",""),j(this,"audioCodec",""),j(this,"videoCodec",""),j(this,"domain",""),j(this,"fps",0),j(this,"bitrate",0),j(this,"width",0),j(this,"height",0),j(this,"samplerate",0),j(this,"channelCount",0),j(this,"gop",0),j(this,"_bitsAccumulateSize",0),j(this,"_bitsAccumulateDuration",0),this._timescale=t}return N(e,[{key:"getStats",value:function(){return{encodeType:this.encodeType,audioCodec:this.audioCodec,videoCodec:this.videoCodec,domain:this.domain,fps:this.fps,bitrate:this.bitrate,width:this.width,height:this.height,samplerate:this.samplerate,channelCount:this.channelCount,gop:this.gop}}},{key:"setEncodeType",value:function(e){this.encodeType=e}},{key:"setFpsFromScriptData",value:function(e){var t,r=e.data,n=null===r||void 0===r||null===(t=r.onMetaData)||void 0===t?void 0:t.framerate;n&&n>0&&n<100&&(this.fps=n)}},{key:"setVideoMeta",value:function(e){if(this.width=e.width,this.height=e.height,this.videoCodec=e.codec,this.encodeType=e.codecType,e.fpsNum&&e.fpsDen){var t=e.fpsNum/e.fpsDen;t>0&&t<100&&(this.fps=t)}}},{key:"setAudioMeta",value:function(e){this.audioCodec=e.codec,this.samplerate=e.sampleRate,this.channelCount=e.channelCount}},{key:"setDomain",value:function(e){this.domain=e.split("/").slice(2,3)[0]}},{key:"updateBitrate",value:function(e){var t=this;if((!this.fps||this.fps>=100)&&e.length){var r=e.reduce((function(e,t){return e+t.duration}),0)/e.length;this.fps=Math.round(this._timescale/r)}e.forEach((function(e){1===e.gopId&&t.gop++,t._bitsAccumulateDuration+=e.duration/(t._timescale/1e3),t._bitsAccumulateSize+=e.units.reduce((function(e,t){return e+t.length}),0),t._bitsAccumulateDuration>=1e3&&(t.bitrate=8*t._bitsAccumulateSize,t._bitsAccumulateDuration=0,t._bitsAccumulateSize=0)}))}}]),e}(),We=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;B(this,e),j(this,"_core",null),j(this,"_samples",[]),this._core=t,this._timescale=r,this._stats=new qe(r),this._bindEvents()}return N(e,[{key:"getStats",value:function(){var e,t,r,n,i,a,o,s=(null===(e=this._core)||void 0===e?void 0:e.media)||{},u=s.currentTime,c=void 0===u?0:u,l=s.decodeFps,h=void 0===l?0:l;return C(C({},this._stats.getStats()),{},{downloadSpeed:(null===(t=this._core)||void 0===t||null===(r=t.speedInfo)||void 0===r?void 0:r.call(t).speed)||0,avgSpeed:(null===(n=this._core)||void 0===n||null===(i=n.speedInfo)||void 0===i?void 0:i.call(n).avgSpeed)||0,currentTime:c,bufferEnd:(null===(a=this._core)||void 0===a||null===(o=a.bufferInfo())||void 0===o?void 0:o.remaining)||0,decodeFps:h})}},{key:"_bindEvents",value:function(){var e=this;this._core.on(D.DEMUXED_TRACK,(function(t){var r=t.videoTrack;return e._stats.updateBitrate(r.samples)})),this._core.on(D.FLV_SCRIPT_DATA,(function(t){e._stats.setFpsFromScriptData(t)})),this._core.on(D.METADATA_PARSED,(function(t){"video"===t.type?e._stats.setVideoMeta(t.track):e._stats.setAudioMeta(t.track)})),this._core.on(D.TTFB,(function(t){e._stats.setDomain(t.responseUrl)}))}},{key:"reset",value:function(){this._samples=[],this._stats=new qe(this._timescale)}}]),e}(),Ke=function(){function e(){B(this,e),j(this,"_prevCurrentTime",0)}return N(e,[{key:"do",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(e){var i=e.currentTime,a=0;if(this._prevCurrentTime===i){var o=ye.info(ye.get(e),i);if(!o.buffers.length)return;r&&o.nextStart||o.nextStart&&o.nextStart-i<t?a=o.nextStart+.1:o.end&&o.end-i>n&&!e.seeking&&(a=i+.1)}this._prevCurrentTime=i,a&&i!==a&&(e.currentTime=a)}}}]),e}(),Ye="undefined"!==typeof window;function Xe(){try{return Ye?window.MediaSource:null}catch(e){}}var Qe=Xe(),Je={APPEND:"appendBuffer",REMOVE:"removeBuffer"},Ze=(Error,function(){function e(t,r){var n=this;B(this,e),j(this,"media",null),j(this,"mediaSource",null),j(this,"_openPromise",Fe()),j(this,"_queue",Object.create(null)),j(this,"_sourceBuffer",Object.create(null)),j(this,"_mseFullFlag",{}),j(this,"_st",0),j(this,"_opst",0),j(this,"_logger",null),j(this,"_config",null),j(this,"_url",null),j(this,"_onSBUpdateEnd",(function(e){var t=n._queue[e];if(t){var r=t.shift();if(r){var i=Ne()-n._opst;n._logger.debug("UpdateEnd",r.opName,i,r.context),r.promise.resolve({name:r.opName,context:r.context,costtime:i}),n._startQueue(e)}}})),j(this,"_onSBUpdateError",(function(e,t){var r=n._queue[e];if(r){var i=r[0];i&&(n._logger.error("UpdateError",e,i.opName,i.context),i.promise.reject(new _e(pe.MEDIA,pe.SUB_TYPES.MSE_APPEND_BUFFER,t)))}})),this._config=Object.assign(e.getDefaultConfig(),r),t&&this.bindMedia(t),this._logger=new le("MSE"),this._config.openLog&&le.enable()}return N(e,[{key:"isOpened",get:function(){var e;return"open"===(null===(e=this.mediaSource)||void 0===e?void 0:e.readyState)}},{key:"url",get:function(){return this._url}},{key:"duration",get:function(){var e;return(null===(e=this.mediaSource)||void 0===e?void 0:e.duration)||-1}},{key:"isEnded",get:function(){return!!this.mediaSource&&"ended"===this.mediaSource.readyState}},{key:"isFull",value:function(t){return t?this._mseFullFlag[t]:this._mseFullFlag[e.VIDEO]}},{key:"updateDuration",value:function(e){var t=this;return this.mediaSource&&this.mediaSource.duration>e?Promise.resolve():this._enqueueBlockingOp((function(){t.isEnded?t._logger.debug("[debug mse] setDuration ended"):t.mediaSource&&(t.mediaSource.duration=e,t._logger.debug("[debug mse] setDuration"))}),"updateDuration")}},{key:"open",value:function(){var e=this;if(this._openPromise.used&&!this.isOpened&&this.mediaSource){var t=this.mediaSource,r=function r(){var n=Ne()-e._st;e._logger.debug("MSE OPEN",n),t.removeEventListener("sourceopen",r),e._openPromise.resolve({costtime:n})};t.addEventListener("sourceopen",r),this._openPromise=Fe()}return this._openPromise}},{key:"bindMedia",value:function(){var e=M(P().mark((function e(t){var r,n,i=this;return P().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.mediaSource&&!this.media){e.next=3;break}return e.next=3,this.unbindMedia();case 3:if(t&&Qe){e.next=5;break}throw new Error("Param media or MediaSource does not exist");case 5:return this.media=t,r=this.mediaSource=new Qe,this._st=Ne(),n=function e(){var n=Ne()-i._st;i._logger.debug("MSE OPEN"),r.removeEventListener("sourceopen",e),URL.revokeObjectURL(t.src),i._openPromise.resolve({costtime:n})},r.addEventListener("sourceopen",n),this._url=URL.createObjectURL(r),t.src=this._url,e.abrupt("return",this._openPromise);case 13:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unbindMedia",value:function(){var e=M(P().mark((function e(){var t,r,n,i=this;return P().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this._openPromise.used||this._openPromise.resolve(),t=this.mediaSource,t){if(Object.keys(this._queue).forEach((function(e){var t=i._queue[e];t&&t.forEach((function(e){return e.promise.resolve}))})),r=!!this.media&&this.media.readyState>=1,n="open"===t.readyState,r&&n)try{t.endOfStream()}catch(a){}Object.keys(this._sourceBuffer).forEach((function(e){try{t.removeSourceBuffer(i._sourceBuffer[e])}catch(a){}}))}if(this.media){this.media.removeAttribute("src");try{this.media.load()}catch(a){}this.media=null}this.mediaSource=null,this._openPromise=Fe(),this._queue=Object.create(null),this._sourceBuffer=Object.create(null);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"createSource",value:function(e,t){if(!this._sourceBuffer[e]&&this.mediaSource){var r;try{r=this._sourceBuffer[e]=this.mediaSource.addSourceBuffer(t)}catch(n){throw new _e(pe.MEDIA,pe.SUB_TYPES.MSE_ADD_SB,n)}r.mimeType=t,r.addEventListener("updateend",this._onSBUpdateEnd.bind(this,e)),r.addEventListener("error",this._onSBUpdateError.bind(this,e))}}},{key:"changeType",value:function(e,t){var r=this,n=this._sourceBuffer[e];return this.mediaSource&&n&&n.mimeType!==t&&"function"===typeof n.changeType?this._enqueueOp(e,(function(){n.changeType(t),n.mimeType=t,r._onSBUpdateEnd(e)})):Promise.resolve()}},{key:"createOrChangeSource",value:function(e,t){return this.createSource(e,t),this.changeType(e,t)}},{key:"append",value:function(e,t,r){var n=this;return t&&t.byteLength&&this._sourceBuffer[e]?this._enqueueOp(e,(function(){var i;n.mediaSource&&(n._logger.debug("MSE APPEND START",r),n._opst=Ne(),null===(i=n._sourceBuffer[e])||void 0===i||i.appendBuffer(t))}),Je.APPEND,r):Promise.resolve()}},{key:"remove",value:function(e,t,r,n){var i=this,a=!1;return this._mseFullFlag[e]&&(a=!0),this._enqueueOp(e,(function(){if(i.mediaSource){var a=i._sourceBuffer[e];t>=r||!a?i._onSBUpdateEnd(e):(i._opst=Ne(),i._logger.debug("MSE REMOVE START",e,t,r,n),a.remove(t,r))}}),Je.REMOVE,n,a)}},{key:"clearBuffer",value:function(e,t){var r,n=this;return Object.keys(this._sourceBuffer).forEach((function(i){r=n._enqueueOp(i,(function(){if(n.mediaSource){var r=n._sourceBuffer[i];n._logger.debug("MSE clearBuffer START",i,e,t),r.remove(e,t)}}))})),r}},{key:"clearAllBuffer",value:function(){var e,t=this;return Object.keys(this._sourceBuffer).forEach((function(r){e=t._enqueueOp(r,(function(){if(t.mediaSource){var e=t._sourceBuffer[r];t._logger.debug("MSE clearAllBuffer START",r),e.remove(0,ye.end(ye.get(e)))}}))})),e}},{key:"clearOpQueues",value:function(e){var t;this._logger.debug("MSE clearOpQueue START");var r=this._queue[e];if(r&&r[e]&&!(r.length<5)){var n=[];r.forEach((function(e){e.context&&e.context.isinit&&n.push(e)})),this._queue[e]=r.slice(0,2),n.length>0&&(t=this._queue[e]).push.apply(t,n)}}},{key:"endOfStream",value:function(e){var t=this;return this.mediaSource&&"open"===this.mediaSource.readyState?this._enqueueBlockingOp((function(){var r=t.mediaSource;r&&"open"===r.readyState&&(t._logger.debug("MSE endOfStream START"),e?r.endOfStream(e):r.endOfStream())}),"endOfStream"):Promise.resolve()}},{key:"setLiveSeekableRange",value:function(e,t){var r=this.mediaSource;e<0||t<e||null===r||void 0===r||!r.setLiveSeekableRange||"open"!==r.readyState||r.setLiveSeekableRange(e,t)}},{key:"getSourceBuffer",value:function(e){return this._sourceBuffer[e]}},{key:"buffered",value:function(e){return ye.get(this._sourceBuffer[e])}},{key:"bufferStart",value:function(e){return ye.start(this.buffered(e))}},{key:"bufferEnd",value:function(e){return ye.end(this.buffered(e))}},{key:"_enqueueOp",value:function(e,t,r,n,i){var a=this;if(!this.mediaSource)return Promise.resolve();var o=this._queue[e]=this._queue[e]||[],s={exec:t,promise:Fe(),opName:r,context:n};return i?(o.splice(0,0,s),this._mseFullFlag[e]=!1,this._startQueue(e)):o.push(s),this.isOpened?1===o.length&&this._startQueue(e):this._openPromise.then((function(){1===o.length&&a._startQueue(e)})),s.promise}},{key:"_enqueueBlockingOp",value:function(){var e=M(P().mark((function e(t,r){var n,i,a=this;return P().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.mediaSource){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:if(n=Object.keys(this._sourceBuffer),n.length){e.next=5;break}return e.abrupt("return",t());case 5:return i=[],n.forEach((function(e){var t=a._queue[e],n=Fe();i.push(n),t.push({exec:function(){return n.resolve()},promise:n,opName:r}),1===t.length&&a._startQueue(e)})),e.abrupt("return",Promise.all(i).then((function(){try{return t()}finally{n.forEach((function(e){var t=a._queue[e],r=a._sourceBuffer[e];null===t||void 0===t||t.shift(),r&&r.updating||a._startQueue(e)}))}})));case 8:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"_startQueue",value:function(e){var t=this._queue[e];if(t){var r=t[0];if(r&&!this._mseFullFlag[e])try{r.exec()}catch(n){n&&n.message&&n.message.indexOf("SourceBuffer is full")>=0?(this._mseFullFlag[e]=!0,this._logger.error("[MSE error],  context,",r.context," ,name,",r.opName,",err,SourceBuffer is full"),r.promise.reject(new _e(pe.MEDIA,pe.SUB_TYPES.MSE_FULL,n))):(this._logger.error(n),r.promise.reject(new _e(pe.MEDIA,pe.SUB_TYPES.MSE_OTHER,n)),t.shift(),this._startQueue(e))}}}},{key:"setTimeoffset",value:function(e,t,r){var n=this;return this._enqueueOp(e,(function(){t<0&&(t+=.001),n._sourceBuffer[e].timestampOffset=t,n._onSBUpdateEnd(e)}),"setTimeoffset",r)}},{key:"abort",value:function(e,t){var r=this;return this.isOpened?this._enqueueOp(e,(function(){r._sourceBuffer[e].abort(),r._onSBUpdateEnd(e)}),"abort",t):Promise.resolve()}}],[{key:"getDefaultConfig",value:function(){return{openLog:!1}}},{key:"isSupported",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"';if(!Qe)return!1;try{return Qe.isTypeSupported(e)}catch(t){return this._logger.error(e,t),!1}}}]),e}());function $e(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a,o,s=[],u=!0,c=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(s.push(n.value),s.length!==t);u=!0);}catch(l){c=!0,i=l}finally{try{if(!u&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}function et(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function tt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Et(n.key),n)}}function rt(e,t,r){return t&&tt(e.prototype,t),r&&tt(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function nt(e,t,r){return t=Et(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function it(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ot(e,t)}function at(e){return at=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},at(e)}function ot(e,t){return ot=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ot(e,t)}function st(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function ut(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ct(e,t){if(t&&("object"===typeof t||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ut(e)}function lt(e){var t=st();return function(){var r,n=at(e);if(t){var i=at(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return ct(this,r)}}function ht(e,t){return pt(e)||$e(e,t)||_t(e,t)||gt()}function dt(e){return ft(e)||vt(e)||_t(e)||mt()}function ft(e){if(Array.isArray(e))return yt(e)}function pt(e){if(Array.isArray(e))return e}function vt(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _t(e,t){if(e){if("string"===typeof e)return yt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?yt(e,t):void 0}}function yt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function mt(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function gt(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function bt(e,t){if("object"!==typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function Et(e){var t=bt(e,"string");return"symbol"===typeof t?t:String(t)}j(Ze,"VIDEO","video"),j(Ze,"AUDIO","audio");var kt=function(){function e(t){et(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]")}return rt(e,[{key:"warn",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).warn.apply(t,[this._prefix].concat(n))}}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();nt(kt,"disabled",!0);var wt={VIDEO:"video",AUDIO:"audio",METADATA:"metadata"},St={AVC:"avc",HEVC:"hevc"},Tt={AAC:"aac",G711PCMA:"g7110a",G711PCMU:"g7110m"},xt={LARGE_AV_SHIFT:"LARGE_AV_SHIFT",LARGE_VIDEO_GAP:"LARGE_VIDEO_GAP",LARGE_VIDEO_GAP_BETWEEN_CHUNK:"LARGE_VIDEO_GAP_BETWEEN_CHUNK",LARGE_AUDIO_GAP:"LARGE_AUDIO_GAP",AUDIO_FILLED:"AUDIO_FILLED",AUDIO_DROPPED:"AUDIO_DROPPED"},At=function(){function e(){et(this,e),nt(this,"id",1),nt(this,"type",wt.VIDEO),nt(this,"codecType",St.AVC),nt(this,"pid",-1),nt(this,"hvcC",void 0),nt(this,"codec",""),nt(this,"timescale",0),nt(this,"formatTimescale",0),nt(this,"sequenceNumber",0),nt(this,"baseMediaDecodeTime",0),nt(this,"baseDts",0),nt(this,"duration",0),nt(this,"warnings",[]),nt(this,"samples",[]),nt(this,"pps",[]),nt(this,"sps",[]),nt(this,"vps",[]),nt(this,"fpsNum",0),nt(this,"fpsDen",0),nt(this,"sarRatio",[]),nt(this,"width",0),nt(this,"height",0),nt(this,"nalUnitSize",4),nt(this,"present",!1),nt(this,"isVideoEncryption",!1),nt(this,"isAudioEncryption",!1),nt(this,"isVideo",!0),nt(this,"kid",null),nt(this,"pssh",null),nt(this,"ext",void 0)}return rt(e,[{key:"reset",value:function(){this.sequenceNumber=this.width=this.height=this.fpsDen=this.fpsNum=this.duration=this.baseMediaDecodeTime=this.timescale=0,this.codec="",this.present=!1,this.pid=-1,this.pps=[],this.sps=[],this.vps=[],this.sarRatio=[],this.samples=[],this.warnings=[],this.hvcC=null}},{key:"exist",value:function(){return!!(this.pps.length&&this.sps.length&&this.codec)}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isVideoEncryption}}]),e}(),Dt=function(){function e(){et(this,e),nt(this,"id",2),nt(this,"type",wt.AUDIO),nt(this,"codecType",Tt.AAC),nt(this,"pid",-1),nt(this,"codec",""),nt(this,"sequenceNumber",0),nt(this,"sampleDuration",0),nt(this,"timescale",0),nt(this,"formatTimescale",0),nt(this,"baseMediaDecodeTime",0),nt(this,"duration",0),nt(this,"warnings",[]),nt(this,"samples",[]),nt(this,"baseDts",0),nt(this,"sampleSize",16),nt(this,"sampleRate",0),nt(this,"channelCount",0),nt(this,"objectType",0),nt(this,"sampleRateIndex",0),nt(this,"config",[]),nt(this,"present",!1),nt(this,"isVideoEncryption",!1),nt(this,"isAudioEncryption",!1),nt(this,"kid",null),nt(this,"ext",void 0)}return rt(e,[{key:"reset",value:function(){this.sequenceNumber=0,this.timescale=0,this.sampleDuration=0,this.sampleRate=0,this.channelCount=0,this.baseMediaDecodeTime=0,this.present=!1,this.pid=-1,this.codec="",this.samples=[],this.config=[],this.warnings=[]}},{key:"exist",value:function(){return!!(this.sampleRate&&this.channelCount&&this.codec&&this.codecType===Tt.AAC)}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isAudioEncryption}}]),e}(),Ot=function(){function e(t,r,n){et(this,e),nt(this,"flag",{}),nt(this,"keyframe",!1),nt(this,"gopId",0),nt(this,"duration",0),nt(this,"size",0),nt(this,"units",[]),nt(this,"chromaFormat",420),this.originPts=this.pts=t,this.originDts=this.dts=r,n&&(this.units=n)}return rt(e,[{key:"cts",get:function(){return this.pts-this.dts}},{key:"setToKeyframe",value:function(){this.keyframe=!0,this.flag.dependsOn=2,this.flag.isNonSyncSample=0}}]),e}(),Rt=rt((function e(t,r,n,i){et(this,e),nt(this,"duration",1024),nt(this,"flag",{dependsOn:2,isNonSyncSample:0}),nt(this,"keyframe",!0),this.originPts=this.pts=this.dts=t,this.data=r,this.size=r.byteLength,this.sampleOffset=i,n&&(this.duration=n)})),Lt=rt((function e(t,r){et(this,e),nt(this,"time",0),this.data=t,this.originPts=this.pts=r})),Ct=function(e){it(r,e);var t=lt(r);function r(){return et(this,r),t.apply(this,arguments)}return rt(r)}(Lt),Pt=function(e){it(r,e);var t=lt(r);function r(){return et(this,r),t.apply(this,arguments)}return rt(r)}(Lt),Ut=function(){function e(){et(this,e),nt(this,"id",3),nt(this,"type",wt.METADATA),nt(this,"timescale",0),nt(this,"flvScriptSamples",[]),nt(this,"seiSamples",[])}return rt(e,[{key:"exist",value:function(){return!(!this.flvScriptSamples.length&&!this.seiSamples.length||!this.timescale)}},{key:"reset",value:function(){this.timescale=0,this.flvScriptSamples=[],this.seiSamples=[]}},{key:"hasSample",value:function(){return!(!this.flvScriptSamples.length&&!this.seiSamples.length)}}]),e}(),It="undefined"!==typeof window,Mt=It&&navigator.userAgent.toLocaleLowerCase(),Bt=It&&/^((?!chrome|android).)*safari/.test(Mt),Ft=It&&Mt.includes("firefox"),Nt=It&&Mt.includes("android"),jt=function(){function e(){et(this,e)}return rt(e,null,[{key:"getRateIndexByRate",value:function(t){return e.FREQ.indexOf(t)}},{key:"parseADTS",value:function(t,r){var n=t.length,i=0;while(i+2<n){if(255===t[i]&&240===(246&t[i+1]))break;i++}if(!(i>=n)){var a=i,o=[],s=(60&t[i+2])>>>2,u=e.FREQ[s];if(!u)throw new Error("Invalid sampling index: ".concat(s));var c,l,h=1+((192&t[i+2])>>>6),d=(1&t[i+2])<<2|(192&t[i+3])>>>6,f=e._getConfig(s,d,h),p=f.config,v=f.codec,_=0,y=e.getFrameDuration(u);while(i+7<n)if(255===t[i]&&240===(246&t[i+1])){if(l=(3&t[i+3])<<11|t[i+4]<<3|(224&t[i+5])>>5,n-i<l)break;c=2*(1&~t[i+1]),o.push({pts:r+_*y,data:t.subarray(i+7+c,i+l)}),_++,i+=l}else i++;return{skip:a,remaining:i>=n?void 0:t.subarray(i),frames:o,samplingFrequencyIndex:s,sampleRate:u,objectType:h,channelCount:d,codec:v,config:p,originCodec:"mp4a.40.".concat(h)}}}},{key:"parseAudioSpecificConfig",value:function(t){if(t.length){var r=t[0]>>>3,n=(7&t[0])<<1|t[1]>>>7,i=(120&t[1])>>>3,a=e.FREQ[n];if(a){var o=e._getConfig(n,i,r),s=o.config,u=o.codec;return{samplingFrequencyIndex:n,sampleRate:a,objectType:r,channelCount:i,config:s,codec:u,originCodec:"mp4a.40.".concat(r)}}}}},{key:"getFrameDuration",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4;return 1024*t/e}},{key:"_getConfig",value:function(e,t,r){var n,i,a=[];return Ft?e>=6?(n=5,i=e-3):(n=2,i=e):Nt?(n=2,i=e):(n=2===r||5===r?r:5,i=e,e>=6?i=e-3:1===t&&(n=2,i=e)),a[0]=n<<3,a[0]|=(14&e)>>1,a[1]=(1&e)<<7,a[1]|=t<<3,5===n&&(a[1]|=(14&i)>>1,a[2]=(1&i)<<7,a[2]|=8,a[3]=0),{config:a,codec:"mp4a.40.".concat(n)}}},{key:"getSilentFrame",value:function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}]),e}();nt(jt,"FREQ",[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]);var Vt=500,Gt=3,Ht=1e3,zt=5e3,qt=1e3,Wt=200,Kt=5e3,Yt=5,Xt=function(){function e(t,r,n){et(this,e),this.videoTrack=t,this.audioTrack=r,this.metadataTrack=n,this._baseDts=-1,this._baseDtsInited=!1,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=0,this._videoTimestampBreak=0,this._lastVideoDuration=0,this._keyFrameInNextChunk=!1,this._lastAudioExceptionGapDot=-1/0,this._lastAudioExceptionOverlapDot=-1/0,this._lastAudioExceptionLargeGapDot=-1/0,this._lastVideoExceptionLargeGapDot=-1/0,this._lastVideoExceptionChunkFirstDtsDot=-1/0}return rt(e,[{key:"fix",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t=Math.round(1e3*t);var i=this.videoTrack,a=this.audioTrack;!r&&n||(this._videoLastSample=null,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=0,this._videoTimestampBreak=0,this._lastAudioExceptionGapDot=-1/0,this._lastAudioExceptionOverlapDot=-1/0,this._lastAudioExceptionLargeGapDot=-1/0,this._lastVideoExceptionLargeGapDot=-1/0,this._lastVideoExceptionChunkFirstDtsDot=-1/0),r&&!n&&(this._baseDtsInited=!1),this._baseDtsInited||this._calculateBaseDts(a,i),!n&&t&&(this._audioNextPts=this._videoNextDts=t);var o=this._baseDtsInited&&(this._videoTimestampBreak||!this.videoTrack.exist())&&(this._audioTimestampBreak||!this.audioTrack.exist());if(o&&this._resetBaseDtsWhenStreamBreaked(),this._fixAudio(a),this._keyFrameInNextChunk=!1,this._fixVideo(i),this.metadataTrack.exist()){var s=this.metadataTrack.timescale;this.metadataTrack.seiSamples.forEach((function(t){t.pts=t.originPts-e._baseDts,t.time=Math.max(0,t.pts)/s})),this.metadataTrack.flvScriptSamples.forEach((function(t){t.pts=t.originPts-e._baseDts,t.time=Math.max(0,t.pts)/s}))}i.samples.length&&(i.baseMediaDecodeTime=i.samples[0].dts),a.samples.length&&(a.baseMediaDecodeTime=a.samples[0].pts*a.timescale/1e3)}},{key:"_fixVideo",value:function(e){var t=this,r=e.samples;if(r.length){var n;if(r.forEach((function(e){e.dts-=t._baseDts,e.pts-=t._baseDts,e.keyframe&&(t._keyFrameInNextChunk=!0)})),e.fpsNum&&e.fpsDen)n=e.timescale*(e.fpsDen/e.fpsNum);else if(e.length>1){var i=e.samples[0],a=e.samples[r.length-1];n=Math.floor((a.dts-i.dts)/(r.length-1))}else n=this._lastVideoDuration||40;var o=r.pop();if(this._videoLastSample&&r.unshift(this._videoLastSample),this._videoLastSample=o,r.length){if(void 0===this._videoNextDts){var s=r[0];this._videoNextDts=s.dts}var u=r.length,c=0,l=r[0],h=this._videoNextDts-l.dts;if(Math.abs(h)>Wt){var d;if(Math.abs(l.dts-this._lastVideoExceptionChunkFirstDtsDot)>Kt)this._lastVideoExceptionChunkFirstDtsDot=l.dts,e.warnings.push({type:xt.LARGE_VIDEO_GAP_BETWEEN_CHUNK,nextDts:this._videoNextDts,firstSampleDts:l.dts,nextSampleDts:null===(d=r[1])||void 0===d?void 0:d.dts,sampleDuration:h});this._videoTimestampBreak>=Yt?(this._videoNextDts=l.dts,this._videoTimestampBreak=0):(l.dts+=h,l.pts+=h,this.audioTrack.exist()||(this._videoTimestampBreak=1))}for(var f=0;f<u;f++){var p=r[f].dts,v=r[f+1];c=f<u-1?v.dts-p:o?o.dts-p:n,(c>qt||c<0)&&(this._videoTimestampBreak++,Math.abs(p-this._lastVideoExceptionLargeGapDot)>Kt&&(this._lastVideoExceptionLargeGapDot=p,e.warnings.push({type:xt.LARGE_VIDEO_GAP,time:p/e.timescale,dts:p,originDts:r[f].originDts,nextDts:this._videoNextDts,sampleDuration:c,refSampleDuration:n})),c=n),r[f].duration=c,this._videoNextDts+=c,this._lastVideoDuration=c}}}}},{key:"_fixAudio",value:function(e){var t=this,r=e.samples;r.length&&(r.forEach((function(e){e.dts=e.pts-=t._baseDts})),this._doFixAudioInternal(e,r,1e3))}},{key:"_calculateBaseDts",value:function(e,t){var r=e.samples,n=t.samples;if(!r.length&&!n.length)return!1;var i=1/0,a=1/0;r.length&&(e.baseDts=i=r[0].pts),n.length&&(t.baseDts=a=n[0].dts),this._baseDts=Math.min(i,a);var o=a-i;return Number.isFinite(o)&&Math.abs(o)>Vt&&t.warnings.push({type:xt.LARGE_AV_SHIFT,videoBaseDts:a,audioBasePts:i,baseDts:this._baseDts,delta:o}),this._baseDtsInited=!0,!0}},{key:"_resetBaseDtsWhenStreamBreaked",value:function(){var e=this._calculateBaseDts(this.audioTrack,this.videoTrack);e&&(this.audioTrack.exist()?this.videoTrack.exist()?this._baseDts-=Math.min(this._audioNextPts,this._videoNextDts):this._baseDts-=this._audioNextPts:this._baseDts-=this._videoNextDts,this._videoTimestampBreak=0,this._audioTimestampBreak=0)}},{key:"_doFixAudioInternal",value:function(e,t,r){e.sampleDuration||(e.sampleDuration=e.codecType===Tt.AAC?jt.getFrameDuration(e.timescale,r):this._getG711Duration(e));var n=e.sampleDuration,i=e.codecType===Tt.AAC?1024:n*e.timescale/1e3;if(void 0===this._audioNextPts){var a=t[0];this._audioNextPts=a.pts}for(var o=0;o<t.length;o++){var s=this._audioNextPts,u=t[o],c=u.pts-s;if(0===o&&this._audioTimestampBreak>=Yt&&this._keyFrameInNextChunk&&(s=this._audioNextPts=u.dts,c=0,this._audioTimestampBreak=0),!this._audioTimestampBreak&&c>=Gt*n&&c<=Ht&&!Bt){var l=this._getSilentFrame(e)||t[0].data.subarray(),h=Math.floor(c/n);Math.abs(u.pts-this._lastAudioExceptionGapDot)>zt&&(this._lastAudioExceptionGapDot=u.pts,e.warnings.push({type:xt.AUDIO_FILLED,pts:u.pts,originPts:u.originPts,count:h,nextPts:s,refSampleDuration:n}));for(var d=0;d<h;d++){var f=new Rt(Math.floor(this._audioNextPts+n)-Math.floor(this._audioNextPts),l,i);f.originPts=Math.floor(this._baseDts+s),t.splice(o,0,f),this._audioNextPts+=n,o++}o--}else c<=-Gt*n&&c>=-1*Ht?(Math.abs(u.pts-this._lastAudioExceptionOverlapDot)>zt&&(this._lastAudioExceptionOverlapDot=u.pts,e.warnings.push({type:xt.AUDIO_DROPPED,pts:u.pts,originPts:u.originPts,nextPts:s,refSampleDuration:n})),t.splice(o,1),o--):(Math.abs(c)>Ht&&(this._audioTimestampBreak++,Math.abs(u.pts-this._lastAudioExceptionLargeGapDot)>zt&&(this._lastAudioExceptionLargeGapDot=u.pts,e.warnings.push({type:xt.LARGE_AUDIO_GAP,time:u.pts/1e3,pts:u.pts,originPts:u.originPts,nextPts:s,sampleDuration:c,refSampleDuration:n}))),u.dts=u.pts=s,u.duration=i,this._audioNextPts+=n)}}},{key:"_getG711Duration",value:function(e){var t=e.sampleSize,r=e.channelCount,n=e.sampleRate,i=e.samples[0];if(i)return 2*i.data.byteLength/r/(t/8)/n*1e3}},{key:"_getSilentFrame",value:function(e){return e.codecType===Tt.AAC?jt.getSilentFrame(e.codec,e.channelCount):new Uint8Array(8*e.sampleDuration*e.channelCount)}}]),e}();function Qt(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t=t.filter(Boolean);var n=new Uint8Array(t.reduce((function(e,t){return e+t.byteLength}),0)),i=0;return t.forEach((function(e){n.set(e,i),i+=e.byteLength})),n}Math.pow(2,32);function Jt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<24>>>0)+(e[t+1]<<16)+(e[t+2]<<8)+(e[t+3]||0)}function Zt(e){for(var t,r="avc1.",n=0;n<3;n++)t=e[n].toString(16),t.length<2&&(t="0".concat(t)),r+=t;return r}function $t(e){if(!Array.isArray(e)){for(var t=[],r="",n=0;n<e.length;n++)n%2&&(r=e[n-1]+e[n],t.push(parseInt(r,16)),r="");return t}return e.map((function(e){return parseInt(e,16)}))}var er=function(){function e(){et(this,e)}return rt(e,null,[{key:"parseAnnexB",value:function(e){var t=e.length,r=2,n=0;while(null!==e[r]&&void 0!==e[r]&&1!==e[r])r++;if(r++,n=r+2,n>=t)return[];var i=[];while(n<t)switch(e[n]){case 0:if(0!==e[n-1]){n+=2;break}if(0!==e[n-2]){n++;break}r!==n-2&&i.push(e.subarray(r,n-2));do{n++}while(1!==e[n]&&n<t);r=n+1,n=r+2;break;case 1:if(0!==e[n-1]||0!==e[n-2]){n+=3;break}r!==n-2&&i.push(e.subarray(r,n-2)),r=n+1,n=r+2;break;default:n+=3;break}return r<t&&i.push(e.subarray(r)),i}},{key:"parseAvcC",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;if(!(e.length<4)){var r,n=e.length,i=[],a=0;while(a+t<n)if(r=Jt(e,a),3===t&&(r>>>=8),a+=t,r){if(a+r>n)break;i.push(e.subarray(a,a+r)),a+=r}return i}}},{key:"parseSEI",value:function(e,t){var r=e.length,n=t?2:1,i=0,a=0,o="";while(255===e[n])i+=255,n++;i+=e[n++];while(255===e[n])a+=255,n++;if(a+=e[n++],5===i&&r>n+16)for(var s=0;s<16;s++)o+=e[n].toString(16),n++;return{payload:e.subarray(n),type:i,size:a,uuid:o}}},{key:"removeEPB",value:function(e){var t=e.byteLength,r=[],n=1;while(n<t-2)0===e[n]&&0===e[n+1]&&3===e[n+2]?(r.push(n+2),n+=2):n++;if(!r.length)return e;var i=t-r.length,a=new Uint8Array(i),o=0;for(n=0;n<i;o++,n++)o===r[0]&&(o++,r.shift()),a[n]=e[o];return a}}]),e}(),tr=function(){function e(t){if(et(this,e),nt(this,"_bytesAvailable",void 0),nt(this,"_bitsAvailable",0),nt(this,"_word",0),!t)throw new Error("ExpGolomb data params is required");this._data=t,this._bytesAvailable=t.byteLength,this._bytesAvailable&&this._loadWord()}return rt(e,[{key:"_loadWord",value:function(){var e=this._data.byteLength-this._bytesAvailable,t=Math.min(4,this._bytesAvailable);if(0===t)throw new Error("No bytes available");var r=new Uint8Array(4);r.set(this._data.subarray(e,e+t)),this._word=new DataView(r.buffer).getUint32(0),this._bitsAvailable=8*t,this._bytesAvailable-=t}},{key:"skipBits",value:function(e){if(this._bitsAvailable>e)this._word<<=e,this._bitsAvailable-=e;else{e-=this._bitsAvailable;var t=Math.floor(e/8);e-=8*t,this._bytesAvailable-=t,this._loadWord(),this._word<<=e,this._bitsAvailable-=e}}},{key:"readBits",value:function(e){if(e>32)throw new Error("Cannot read more than 32 bits");var t=Math.min(this._bitsAvailable,e),r=this._word>>>32-t;return this._bitsAvailable-=t,this._bitsAvailable>0?this._word<<=t:this._bytesAvailable>0&&this._loadWord(),t=e-t,t>0&&this._bitsAvailable?r<<t|this.readBits(t):r}},{key:"skipLZ",value:function(){var e;for(e=0;e<this._bitsAvailable;++e)if(0!==(this._word&2147483648>>>e))return this._word<<=e,this._bitsAvailable-=e,e;return this._loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"skipScalingList",value:function(e){for(var t,r=8,n=8,i=0;i<e;i++)0!==n&&(t=this.readEG(),n=(r+t+256)%256),r=0===n?r:n}}]),e}(),rr=function(){function e(){et(this,e)}return rt(e,null,[{key:"parseAVCDecoderConfigurationRecord",value:function(t){if(!(t.length<7)){for(var r,n,i=1+(3&t[4]),a=[],o=[],s=6,u=31&t[5],c=0;c<u;c++)if(n=t[s]<<8|t[s+1],s+=2,n){var l=t.subarray(s,s+n);s+=n,a.push(l),r||(r=e.parseSPS(er.removeEPB(l)))}var h,d=t[s];s++;for(var f=0;f<d;f++)h=t[s]<<8|t[s+1],s+=2,h&&(o.push(t.subarray(s,s+h)),s+=h);return{sps:r,spsArr:a,ppsArr:o,nalUnitSize:i}}}},{key:"parseSPS",value:function(e){var t=new tr(e);t.readUByte();var r=t.readUByte(),n=t.readUByte(),i=t.readUByte();t.skipUEG();var a=420;if(100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r||138===r||144===r){var o=t.readUEG();if(o<=3&&(a=[0,420,422,444][o]),3===o&&t.skipBits(1),t.skipUEG(),t.skipUEG(),t.skipBits(1),t.readBool())for(var s=3!==o?8:12,u=0;u<s;u++)t.readBool()&&(u<6?t.skipScalingList(16):t.skipScalingList(64))}t.skipUEG();var c=t.readUEG();if(0===c)t.readUEG();else if(1===c){t.skipBits(1),t.skipUEG(),t.skipUEG();for(var l=t.readUEG(),h=0;h<l;h++)t.skipUEG()}t.skipUEG(),t.skipBits(1);var d=t.readUEG(),f=t.readUEG(),p=t.readBits(1);0===p&&t.skipBits(1),t.skipBits(1);var v,_,y,m,g,b=0,E=0,k=0,w=0;if(t.readBool()&&(b=t.readUEG(),E=t.readUEG(),k=t.readUEG(),w=t.readUEG()),t.readBool()){if(t.readBool()){var S=t.readUByte();switch(S){case 1:v=[1,1];break;case 2:v=[12,11];break;case 3:v=[10,11];break;case 4:v=[16,11];break;case 5:v=[40,33];break;case 6:v=[24,11];break;case 7:v=[20,11];break;case 8:v=[32,11];break;case 9:v=[80,33];break;case 10:v=[18,11];break;case 11:v=[15,11];break;case 12:v=[64,33];break;case 13:v=[160,99];break;case 14:v=[4,3];break;case 15:v=[3,2];break;case 16:v=[2,1];break;case 255:v=[t.readUByte()<<8|t.readUByte(),t.readUByte()<<8|t.readUByte()];break}}if(t.readBool()&&t.readBool(),t.readBool()&&(t.readBits(4),t.readBool()&&t.readBits(24)),t.readBool()&&(t.readUEG(),t.readUEG()),t.readBool()){var T=t.readBits(32),x=t.readBits(32);_=t.readBool(),y=x,m=2*T,g=y/m}}return{codec:Zt(e.subarray(1,4)),profileIdc:r,profileCompatibility:n,levelIdc:i,chromaFormat:a,width:Math.ceil(16*(d+1)-2*(b+E)),height:(2-p)*(f+1)*16-(p?2:4)*(k+w),sarRatio:v,fpsNum:y,fpsDen:m,fps:g,fixedFrame:_}}}]),e}(),nr=function(){function e(){et(this,e)}return rt(e,null,[{key:"parseHEVCDecoderConfigurationRecord",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(t.length<23)){r=r||{};for(var n,i,a,o,s,u=1+(3&t[21]),c=[],l=[],h=[],d=23,f=t[22],p=0;p<f;p++){a=63&t[d],o=t[d+1]<<8|t[d+2],d+=3;for(var v=0;v<o;v++)if(s=t[d]<<8|t[d+1],d+=2,s){switch(a){case 32:var _=t.subarray(d,d+s);n||(n=e.parseVPS(er.removeEPB(_),r)),h.push(_);break;case 33:var y=t.subarray(d,d+s);i||(i=e.parseSPS(er.removeEPB(y),r)),c.push(y);break;case 34:l.push(t.subarray(d,d+s));break}d+=s}}return{hvcC:r,sps:i,spsArr:c,ppsArr:l,vpsArr:h,nalUnitSize:u}}}},{key:"parseVPS",value:function(t,r){r=r||{};var n=new tr(t);n.readUByte(),n.readUByte(),n.readBits(12);var i=n.readBits(3);return r.numTemporalLayers=Math.max(r.numTemporalLayers||0,i+1),n.readBits(17),e._parseProfileTierLevel(n,i,r),r}},{key:"parseSPS",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r=r||{};var n=new tr(t);n.readUByte(),n.readUByte(),n.readBits(4);var i=n.readBits(3);r.numTemporalLayers=Math.max(i+1,r.numTemporalLayers||0),r.temporalIdNested=n.readBits(1),e._parseProfileTierLevel(n,i,r),n.readUEG();var a=r.chromaFormatIdc=n.readUEG(),o=420;a<=3&&(o=[0,420,422,444][a]);var s=0;3===a&&(s=n.readBits(1));var u,c,l,h,d=n.readUEG(),f=n.readUEG(),p=n.readBits(1);if(1===p&&(u=n.readUEG(),c=n.readUEG(),l=n.readUEG(),h=n.readUEG()),r.bitDepthLumaMinus8=n.readUEG(),r.bitDepthChromaMinus8=n.readUEG(),1===p){var v=1!==a&&2!==a||0!==s?1:2,_=1===a&&0===s?2:1;d-=v*(c+u),f-=_*(h+l)}return{codec:"hev1.1.6.L93.B0",width:d,height:f,chromaFormat:o,hvcC:r}}},{key:"_parseProfileTierLevel",value:function(e,t,r){var n=r.generalTierFlag||0;r.generalProfileSpace=e.readBits(2),r.generalTierFlag=Math.max(e.readBits(1),n),r.generalProfileIdc=Math.max(e.readBits(5),r.generalProfileIdc||0),r.generalProfileCompatibilityFlags=e.readBits(32),r.generalConstraintIndicatorFlags=[e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8)];var i=e.readBits(8);n<r.generalTierFlag?r.generalLevelIdc=i:r.generalLevelIdc=Math.max(i,r.generalLevelIdc||0);for(var a=[],o=[],s=0;s<t;s++)a[s]=e.readBits(1),o[s]=e.readBits(1);t>0&&e.readBits(2*(8-t));for(var u=0;u<t;u++)0!==a[u]&&(e.readBits(2),e.readBits(1),e.readBits(5),e.readBits(16),e.readBits(16),e.readBits(4),e.readBits(16),e.readBits(16),e.readBits(12)),0!==o[u]&&e.readBits(8)}}]),e}(),ir=function(){function e(){et(this,e)}return rt(e,null,[{key:"decode",value:function(t){var r=[],n=t,i=0,a=t.length;while(i<a)if(n[i]<128)r.push(String.fromCharCode(n[i])),++i;else{if(n[i]<192);else if(n[i]<224){if(e._checkContinuation(n,i,1)){var o=(31&n[i])<<6|63&n[i+1];if(o>=128){r.push(String.fromCharCode(65535&o)),i+=2;continue}}}else if(n[i]<240){if(e._checkContinuation(n,i,2)){var s=(15&n[i])<<12|(63&n[i+1])<<6|63&n[i+2];if(s>=2048&&55296!==(63488&s)){r.push(String.fromCharCode(65535&s)),i+=3;continue}}}else if(n[i]<248&&e._checkContinuation(n,i,3)){var u=(7&n[i])<<18|(63&n[i+1])<<12|(63&n[i+2])<<6|63&n[i+3];if(u>65536&&u<1114112){u-=65536,r.push(String.fromCharCode(u>>>10|55296)),r.push(String.fromCharCode(1023&u|56320)),i+=4;continue}}r.push(String.fromCharCode(65533)),++i}return r.join("")}},{key:"_checkContinuation",value:function(e,t,r){var n=e;if(t+r<n.length){while(r--)if(128!==(192&n[++t]))return!1;return!0}return!1}}]),e}(),ar=function(){function e(){et(this,e)}return rt(e,null,[{key:"parse",value:function(t){if(!(t.length<3)){var r={},n=e._parseValue(new DataView(t.buffer,t.byteOffset,t.byteLength)),i=e._parseValue(new DataView(t.buffer,t.byteOffset+n.size,t.byteLength-n.size));return r[n.data]=i.data,r}}},{key:"_parseValue",value:function(t){var r,n=t.byteLength,i=t.getUint8(0),a=1,o=!1;switch(i){case 0:r=t.getFloat64(1),a+=8;break;case 1:r=!!t.getUint8(1),a+=1;break;case 2:var s=e._parseString(new DataView(t.buffer,t.byteOffset+a,t.byteLength-a)),u=s.data,c=s.size;r=u,a+=c;break;case 3:r={};var l=0;9===(16777215&t.getUint32(n-4))&&(l=3);while(a<n-4){var h=e._parseObject(new DataView(t.buffer,t.byteOffset+a,t.byteLength-a-l)),d=h.size,f=h.data,p=h.isEnd;if(p)break;r[f.name]=f.value,a+=d}if(a<=n-3){var v=16777215&t.getUint32(a-1);9===v&&(a+=3)}break;case 8:r={},a+=4;var _=0;9===(16777215&t.getUint32(n-4))&&(_=3);while(a<n-8){var y=e._parseObject(new DataView(t.buffer,t.byteOffset+a,t.byteLength-a-_)),m=y.size,g=y.data,b=y.isEnd;if(b)break;r[g.name]=g.value,a+=m}if(a<=n-3){var E=16777215&t.getUint32(a-1);9===E&&(a+=3)}break;case 9:r=void 0,a=1,o=!0;break;case 10:r=[];var k=t.getUint32(1);a+=4;for(var w=0;w<k;w++){var S=e._parseValue(new DataView(t.buffer,t.byteOffset+a,t.byteLength-a)),T=S.data,x=S.size;r.push(T),a+=x}break;case 11:var A=t.getFloat64(a)+6e4*t.getInt16(a+8);r=new Date(A),a+=10;break;case 12:var D=t.getUint32(1);a+=4,r="",D>0&&(r=ir.decode(new Uint8Array(t.buffer,t.byteOffset+a,D))),a+=D;break;default:a=n;break}return{data:r,size:a,isEnd:o}}},{key:"_parseString",value:function(e){var t=e.getUint16(0),r="";return t>0&&(r=ir.decode(new Uint8Array(e.buffer,e.byteOffset+2,t))),{data:r,size:2+t}}},{key:"_parseObject",value:function(t){if(!(t.byteLength<3)){var r=e._parseString(t),n=e._parseValue(new DataView(t.buffer,t.byteOffset+r.size,t.byteLength-r.size));return{data:{name:r.data,value:n.data},size:r.size+n.size,isEnd:n.isEnd}}}}]),e}(),or=new kt("FlvDemuxer"),sr=function(){function e(t,r,n){et(this,e),nt(this,"_headerParsed",!1),nt(this,"_remainingData",null),nt(this,"_gopId",0),nt(this,"_needAddMetaBeforeKeyFrameNal",!0),this.videoTrack=t||new At,this.audioTrack=r||new Dt,this.metadataTrack=n||new Ut,this._fixer=new Xt(this.videoTrack,this.audioTrack,this.metadataTrack)}return rt(e,[{key:"demux",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=this.audioTrack,a=this.videoTrack,o=this.metadataTrack;if(!r&&n||(this._remainingData=null,this._headerParsed=!1),r?(a.reset(),i.reset(),o.reset()):(a.samples=[],i.samples=[],o.seiSamples=[],o.flvScriptSamples=[],a.warnings=[],i.warnings=[],this._remainingData&&(t=Qt(this._remainingData,t),this._remainingData=null)),!t.length)return{videoTrack:a,audioTrack:i,metadataTrack:o};var s=0;if(!this._headerParsed){if(!e.probe(t))throw new Error("Invalid flv file");i.present=(4&t[4])>>>2!==0,a.present=0!==(1&t[4]),this._headerParsed=!0,s=Jt(t,5)+4}var u,c,l,h,d,f=t.length;while(s+15<f){if(u=t[s],c=t[s+1]<<16|t[s+2]<<8|t[s+3],s+15+c>f)break;l=(t[s+7]<<24>>>0)+(t[s+4]<<16)+(t[s+5]<<8)+t[s+6],s+=11,h=t.subarray(s,s+c),8===u?this._parseAudio(h,l):9===u?this._parseVideo(h,l):18===u?this._parseScript(h,l):or.warn("Invalid tag type: ".concat(u)),s+=c,d=Jt(t,s),d!==11+c&&or.warn("Invalid PrevTagSize ".concat(d," (").concat(11+c,")")),s+=4}return s<f&&(this._remainingData=t.subarray(s)),i.formatTimescale=a.formatTimescale=a.timescale=o.timescale=1e3,i.timescale=i.sampleRate||0,!i.exist()&&i.hasSample()&&i.reset(),!a.exist()&&a.hasSample()&&a.reset(),{videoTrack:a,audioTrack:i,metadataTrack:o}}},{key:"fix",value:function(e,t,r){return this._fixer.fix(e,t,r),{videoTrack:this.videoTrack,audioTrack:this.audioTrack,metadataTrack:this.metadataTrack}}},{key:"demuxAndFix",value:function(e,t,r,n){return this.demux(e,t,r),this.fix(n,t,r)}},{key:"_parseAudio",value:function(t,r){if(t.length){var n=(240&t[0])>>>4,i=this.audioTrack;if(10!==n&&7!==n&&8!==n)return or.warn("Unsupported sound format: ".concat(n)),void i.reset();if(10!==n){var a=(12&t[0])>>2,o=(2&t[0])>>1,s=1&t[0];i.sampleRate=e.AUDIO_RATE[a],i.sampleSize=o?16:8,i.channelCount=s+1}10===n?this._parseAac(t,r):this._parseG711(t,r,n)}}},{key:"_parseG711",value:function(e,t,r){var n=this.audioTrack;n.codecType=7===r?Tt.G711PCMA:Tt.G711PCMU,n.sampleRate=8e3,n.codec=n.codecType,n.samples.push(new Rt(t,e.subarray(1)))}},{key:"_parseAac",value:function(e,t){var r=this.audioTrack;if(r.codecType=Tt.AAC,0===e[1]){var n=jt.parseAudioSpecificConfig(e.subarray(2));n?(r.codec=n.codec,r.channelCount=n.channelCount,r.sampleRate=n.sampleRate,r.config=n.config,r.objectType=n.objectType,r.sampleRateIndex=n.samplingFrequencyIndex):(r.reset(),or.warn("Cannot parse AudioSpecificConfig",e))}else if(1===e[1]){if(void 0===t||null===t)return;r.samples.push(new Rt(t,e.subarray(2)))}else or.warn("Unknown AACPacketType: ".concat(e[1]))}},{key:"_parseVideo",value:function(e,t){var r=this;if(!(e.length<6)){var n=(240&e[0])>>>4,i=15&e[0],a=this.videoTrack;if(7!==i&&12!==i)return a.reset(),void or.warn("Unsupported codecId: ".concat(i));var o=12===i;a.codecType=o?St.HEVC:St.AVC;var s=e[1],u=(e[2]<<16|e[3]<<8|e[4])<<8>>8;if(0===s){var c=e.subarray(5),l=o?nr.parseHEVCDecoderConfigurationRecord(c):rr.parseAVCDecoderConfigurationRecord(c);if(l){var h=l.hvcC,d=l.sps,f=l.ppsArr,p=l.spsArr,v=l.vpsArr,_=l.nalUnitSize;h&&(a.hvcC=a.hvcC||h),d&&(a.codec=d.codec,a.width=d.width,a.height=d.height,a.sarRatio=d.sarRatio,a.fpsNum=d.fpsNum,a.fpsDen=d.fpsDen),p.length&&(a.sps=p),f.length&&(a.pps=f),v&&v.length&&(a.vps=v),_&&(a.nalUnitSize=_)}else or.warn("Cannot parse ".concat(o?"HEVC":"AVC","DecoderConfigurationRecord"),e)}else if(1===s){var y=er.parseAvcC(e.subarray(5),a.nalUnitSize);if(y=this._checkAddMetaNalToUnits(o,y,a),y&&y.length){var m=new Ot(t+u,t,y);1===n&&m.setToKeyframe(),a.samples.push(m),y.forEach((function(e){var n=o?e[0]>>>1&63:31&e[0];switch(n){case 5:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:if(!o&&5!==n||o&&5===n)break;m.setToKeyframe();break;case 6:case 39:case 40:if(!o&&6!==n||o&&6===n)break;r.metadataTrack.seiSamples.push(new Pt(er.parseSEI(er.removeEPB(e),o),t+u));break}})),m.keyframe&&this._gopId++,m.gopId=this._gopId}else or.warn("Cannot parse NALUs",e)}else 2===s||or.warn("Unknown AVCPacketType: ".concat(s))}}},{key:"_checkAddMetaNalToUnits",value:function(e,t,r){if(!e||!this._needAddMetaBeforeKeyFrameNal)return this._needAddMetaBeforeKeyFrameNal=!1,t;var n=t.map((function(e){return e[0]>>>1&63}));return n.includes(32)?(this._needAddMetaBeforeKeyFrameNal=!1,t):(t.unshift(r.pps[0]),t.unshift(r.sps[0]),t.unshift(r.vps[0]),t.filter(Boolean))}},{key:"_parseScript",value:function(e,t){this.metadataTrack.flvScriptSamples.push(new Ct(ar.parse(e),t))}}],[{key:"probe",value:function(e){return 70===e[0]&&76===e[1]&&86===e[2]&&1===e[3]&&Jt(e,5)>=9}}]),e}();function ur(e){for(var t=0,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];n.forEach((function(e){t+=e.length}));var a=new e(t),o=0;return n.forEach((function(e){a.set(e,o),o+=e.length})),a}nt(sr,"AUDIO_RATE",[5500,11e3,22e3,44e3]);var cr=function(){function e(){et(this,e),this.buffer=new Uint8Array(0)}return rt(e,[{key:"write",value:function(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];r.forEach((function(t){t?e.buffer=ur(Uint8Array,e.buffer,t):window.console.warn(t)}))}}],[{key:"writeUint16",value:function(e){return new Uint8Array([e>>8&255,255&e])}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>24,e>>16&255,e>>8&255,255&e])}}]),e}(),lr=Math.pow(2,32)-1,hr=function(){function e(){et(this,e)}return rt(e,null,[{key:"box",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];r=r.filter(Boolean);var i=8+r.reduce((function(e,t){return e+t.byteLength}),0),a=new Uint8Array(i);a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=255&i,a.set(e,4);var o=8;return r.forEach((function(e){a.set(e,o),o+=e.byteLength})),a}},{key:"ftyp",value:function(t){var r=t.find((function(e){return e.type===wt.VIDEO&&e.codecType===St.HEVC}));return r?e.FTYPHEV1:e.FTYPAVC1}},{key:"initSegment",value:function(t){var r=e.ftyp(t),n=Qt(r,e.moov(t));return n}},{key:"pssh",value:function(t){var r=new Uint8Array([1,0,0,0].concat([16,119,239,236,192,178,77,2,172,227,60,30,82,226,251,75],[0,0,0,1],$t(t.kid),[0,0,0,0]));return e.box(e.types.pssh,r)}},{key:"moov",value:function(t){if(t[0].useEME&&(t[0].encv||t[0].enca)){t[0].pssh||(t[0].pssh={kid:t[0].kid});var r=this.pssh(t[0].pssh);return e.box.apply(e,[e.types.moov,e.mvhd(t[0].mvhdDurtion||t[0].duration,t[0].mvhdTimecale||t[0].timescale),e.mvex(t)].concat(dt(t.map((function(t){return e.trak(t)}))),[r]))}return e.box.apply(e,[e.types.moov,e.mvhd(t[0].mvhdDurtion||t[0].duration,t[0].mvhdTimecale||t[0].timescale)].concat(dt(t.map((function(t){return e.trak(t)}))),[e.mvex(t)]))}},{key:"mvhd",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4,n=e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,t>>24&255,t>>16&255,t>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]));return n}},{key:"trak",value:function(t){var r=e.box(e.types.trak,e.tkhd(t.id,t.tkhdDuration||0,t.width,t.height),e.mdia(t));return r}},{key:"tkhd",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,i>>8&255,255&i,0,0]));return a}},{key:"mdia",value:function(t){var r=e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minf(t));return r}},{key:"mdhd",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4,n=e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,t>>24&255,t>>16&255,t>>8&255,255&t,85,196,0,0]));return n}},{key:"hdlr",value:function(t){var r=e.box(e.types.hdlr,e.HDLR_TYPES[t]);return r}},{key:"minf",value:function(t){var r=e.box(e.types.minf,t.type===wt.VIDEO?e.VMHD:e.SMHD,e.DINF,e.stbl(t));return r}},{key:"stbl",value:function(t){var r=[];t&&t.ext&&t.ext.stss&&r.push(e.stss(t.ext.stss.entries));var n=e.box(e.types.stbl,e.stsd(t),e.STTS,r[0],e.STSC,e.STSZ,e.STCO);return n}},{key:"stsd",value:function(t){var r;r="audio"===t.type?t.useEME&&t.enca?e.enca(t):e.mp4a(t):t.useEME&&t.encv?e.encv(t):e.avc1hev1(t);var n=e.box(e.types.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),r);return n}},{key:"enca",value:function(t){var r=t.enca.channelCount,n=t.enca.sampleRate,i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r,0,16,0,0,0,0,n>>8&255,255&n,0,0]),a=e.esds(t.config),o=e.sinf(t.enca);return e.box(e.types.enca,i,a,o)}},{key:"encv",value:function(t){var r,n,i=t.sps.length>0?t.sps[0]:[],a=t.pps.length>0?t.pps[0]:[],o=t.width,s=t.height,u=t.sarRatio[0],c=t.sarRatio[1],l=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,s>>8&255,255&s,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h=new Uint8Array((r=(n=[1,i[1],i[2],i[3],255,225,i.length>>>8&255,255&i.length]).concat.apply(n,dt(i)).concat([1,a.length>>>8&255,255&a.length])).concat.apply(r,dt(a))),d=new Uint8Array([0,0,88,57,0,15,200,192,0,4,86,72]),f=e.sinf(t.encv),p=new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,c>>24,c>>16&255,c>>8&255,255&c]);return e.box(e.types.encv,l,e.box(e.types.avcC,h),e.box(e.types.btrt,d),f,e.box(e.types.pasp,p))}},{key:"schi",value:function(t){var r=new Uint8Array([]),n=e.tenc(t);return e.box(e.types.schi,r,n)}},{key:"tenc",value:function(t){var r=new Uint8Array([0,0,0,0,0,0,255&t.default_IsEncrypted,255&t.default_IV_size].concat($t(t.default_KID)));return e.box(e.types.tenc,r)}},{key:"sinf",value:function(t){var r=new Uint8Array([]),n=new Uint8Array([t.data_format.charCodeAt(0),t.data_format.charCodeAt(1),t.data_format.charCodeAt(2),t.data_format.charCodeAt(3)]),i=new Uint8Array([0,0,0,0,99,101,110,99,0,1,0,0]),a=e.schi(t);return e.box(e.types.sinf,r,e.box(e.types.frma,n),e.box(e.types.schm,i),a)}},{key:"avc1hev1",value:function(t){var r=t.codecType===St.HEVC,n=r?e.types.hvc1:e.types.avc1,i=r?e.hvcC(t):e.avcC(t),a=[new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t.width>>8&255,255&t.width,t.height>>8&255,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),i];return r?a.push(e.box(e.types.fiel,new Uint8Array([1,0]))):t.sarRatio&&t.sarRatio.length>1&&a.push(e.pasp(t.sarRatio)),e.box.apply(e,[n].concat(a))}},{key:"avcC",value:function(t){var r,n,i,a=[],o=[];return t.sps.forEach((function(e){i=e.byteLength,a.push(i>>>8&255),a.push(255&i),a.push.apply(a,dt(e))})),t.pps.forEach((function(e){i=e.byteLength,o.push(i>>>8&255),o.push(255&i),o.push.apply(o,dt(e))})),e.box(e.types.avcC,new Uint8Array((r=(n=[1,a[3],a[4],a[5],255,224|t.sps.length]).concat.apply(n,a).concat([t.pps.length])).concat.apply(r,o)))}},{key:"hvcC",value:function(t){var r=t.hvcC;if(r instanceof ArrayBuffer||r instanceof Uint8Array)return r;var n,i=t.vps,a=t.sps,o=t.pps;if(r){var s=r.generalProfileCompatibilityFlags,u=r.generalConstraintIndicatorFlags,c=(i.length&&1)+(a.length&&1)+(o.length&&1);n=[1,r.generalProfileSpace<<6|r.generalTierFlag<<5|r.generalProfileIdc,s>>>24,s>>>16,s>>>8,s,u[0],u[1],u[2],u[3],u[4],u[5],r.generalLevelIdc,240,0,252,252|r.chromaFormatIdc,248|r.bitDepthLumaMinus8,248|r.bitDepthChromaMinus8,0,0,r.numTemporalLayers<<3|r.temporalIdNested<<2|3,c];var l=function(e){var t;n.push(e.length>>8,e.length),(t=n).push.apply(t,dt(e))};i.length&&(n.push(160,0,i.length),i.forEach(l)),a.length&&(n.push(161,0,a.length),a.forEach(l)),o.length&&(n.push(162,0,o.length),o.forEach(l))}else n=[1,1,96,0,0,0,144,0,0,0,0,0,93,240,0,252,253,248,248,0,0,15,3,160,0,1,0,24,64,1,12,1,255,255,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,153,152,9,161,0,1,0,45,66,1,1,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,160,2,128,128,45,22,89,153,164,147,43,154,128,128,128,130,0,0,3,0,2,0,0,3,0,50,16,162,0,1,0,7,68,1,193,114,180,98,64];return e.box(e.types.hvcC,new Uint8Array(n))}},{key:"pasp",value:function(t){var r=ht(t,2),n=r[0],i=r[1];return e.box(e.types.pasp,new Uint8Array([n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i]))}},{key:"mp4a",value:function(t){return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.sampleRate>>8&255,255&t.sampleRate,0,0]),t.config.length?e.esds(t.config):void 0)}},{key:"esds",value:function(t){var r=t.length,n=e.box(e.types.esds,new Uint8Array([0,0,0,0,3,23+r,0,0,0,4,15+r,64,21,0,6,0,0,0,218,192,0,0,218,192,5].concat([r]).concat(t).concat([6,1,2])));return n}},{key:"mvex",value:function(t){var r=e.box.apply(e,[e.types.mvex].concat(dt(t.map((function(t){return e.trex(t.id)})))));return r}},{key:"trex",value:function(t){var r=e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]));return r}},{key:"trex1",value:function(t){var r=e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,2,0,0,0,0,0,0,1,0,0]));return r}},{key:"trex2",value:function(t){var r=e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,4,0,0,0,0,0,2,0,0,0]));return r}},{key:"moof",value:function(t){var r=e.box.apply(e,[e.types.moof,e.mfhd(t[0].samples?t[0].samples[0].gopId:0)].concat(dt(t.map((function(t){return e.traf(t)})))));return r}},{key:"mfhd",value:function(t){var r=e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]));return r}},{key:"traf",value:function(t){var r,n=e.tfhd(t.id),i=e.tfdt(t,t.baseMediaDecodeTime),a=0;if(t.isVideo&&t.videoSenc&&(r=t.videoSenc,r.forEach((function(e){a+=8,e.subsamples&&e.subsamples.length&&(a+=2,a+=6*e.subsamples.length)}))),t.videoSencLength=a,t.useEME&&(t.isVideoEncryption||t.isAudioEncryption)){if(t.isVideoEncryption){if(t.isVideo){var o=e.saiz(t),s=e.saio(t),u=e.trun1(t),c=e.senc(t),l=e.box(e.types.traf,n,i,o,s,u,c);return l}if(t.isAudioEncryption){var h=e.sbgp(),d=e.saiz(t),f=e.saio(t),p=e.senc(t),v=e.trun1(t),_=e.box(e.types.traf,n,i,h,d,f,p,v);return _}var y=e.sbgp(),m=e.trun1(t);return e.box(e.types.traf,n,i,y,m)}if(t.isVideo){var g=e.trun1(t);return e.box(e.types.traf,n,i,g)}var b=e.sbgp(),E=e.saiz(t),k=e.saio(t),w=e.senc(t),S=e.trun1(t),T=e.box(e.types.traf,n,i,b,E,k,w,S);return T}var x=e.sdtp(t),A=76;return e.box(e.types.traf,n,i,x,e.trun(t.samples,x.byteLength+A))}},{key:"sdtp",value:function(t){var r=new cr;return t.samples.forEach((function(e){r.write(new Uint8Array(t.isVideo?[e.keyframe?32:16]:[16]))})),e.box(e.types.sdtp,this.extension(0,0),r.buffer)}},{key:"trun1",value:function(t){var r=new cr,n=cr.writeUint32(t.samples.length),i=null;if(t.isVideo){var a=t.videoSencLength;i=cr.writeUint32(16*t.samples.length+a+149),!t.isVideoEncryption&&t.isAudioEncryption&&(i=cr.writeUint32(16*t.samples.length+92))}else{var o=12*t.samples.length+124;t.isAudioEncryption&&(o=12*t.samples.length+8*t.audioSenc.length+177),i=cr.writeUint32(o)}return t.samples.forEach((function(e){r.write(cr.writeUint32(e.duration)),r.write(cr.writeUint32(e.size)),r.write(cr.writeUint32(e.keyframe?33554432:65536)),t.isVideo&&r.write(cr.writeUint32(e.cts?e.cts:0))})),e.box(e.types.trun,this.extension(0,t.flags),n,i,r.buffer)}},{key:"senc",value:function(t){var r=new cr,n=t.samples.length,i=t.isVideo?16:8,a=t.isVideo?2:0,o=[],s=0;return t.isVideo?(o=t.videoSenc,s=t.videoSencLength):o=t.audioSenc,s=s||i*n,r.write(cr.writeUint32(16+s),e.types.senc,this.extension(0,a)),r.write(cr.writeUint32(n)),o.forEach((function(e){for(var t=0;t<e.InitializationVector.length;t++)r.write(new Uint8Array([e.InitializationVector[t]]));e.subsamples&&e.subsamples.length&&(r.write(cr.writeUint16(e.subsamples.length)),e.subsamples.forEach((function(e){r.write(cr.writeUint16(e.BytesOfClearData)),r.write(cr.writeUint32(e.BytesOfProtectedData))})))})),r.buffer}},{key:"saio",value:function(t){var r=12*t.samples.length+141;!t.isVideo&&t.isAudioEncryption&&(r=149);var n=new Uint8Array([1,0,0,0,0,0,0,1,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r]);return e.box(e.types.saio,n)}},{key:"saiz",value:function(t){var r=t.samples.length,n=new Uint8Array([0,0,0,0,16,r>>24&255,r>>16&255,r>>8&255,255&r]);return e.box(e.types.saiz,n)}},{key:"sbgp",value:function(){var t=new Uint8Array([114,111,108,108,0,0,0,1,0,0,1,25,0,0,0,1]);return e.box(e.types.sbgp,this.extension(0,0),t)}},{key:"extension",value:function(e,t){return new Uint8Array([e,t>>16&255,t>>8&255,255&t])}},{key:"tfhd",value:function(t){return e.box(e.types.tfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"tfdt",value:function(t,r){var n=Math.floor(r/(lr+1)),i=Math.floor(r%(lr+1));return t.useEME&&(t.isVideoEncryption||t.isAudioEncryption)?e.box(e.types.tfdt,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])):e.box(e.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i]))}},{key:"trun",value:function(t,r){var n=t.length,i=12+16*n;r+=8+i;var a=new Uint8Array(i);a.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0);for(var o=0;o<n;o++){var s=t[o],u=s.duration,c=s.size,l=s.flag,h=void 0===l?{}:l,d=s.cts,f=void 0===d?0:d;a.set([u>>>24&255,u>>>16&255,u>>>8&255,255&u,c>>>24&255,c>>>16&255,c>>>8&255,255&c,h.isLeading<<2|(null===h.dependsOn||void 0===h.dependsOn?1:h.dependsOn),h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|(null===h.isNonSyncSample||void 0===h.isNonSyncSample?1:h.isNonSyncSample),61440&h.degradationPriority,15&h.degradationPriority,f>>>24&255,f>>>16&255,f>>>8&255,255&f],12+16*o)}return e.box(e.types.trun,a)}},{key:"moovMP4",value:function(t){return e.box.apply(e,[e.types.moov,e.mvhd(t[0].duration,t[0].timescale)].concat(dt(t.map((function(t){return e.trackMP4(t)})))))}},{key:"trackMP4",value:function(t){return e.box(e.types.trak,e.tkhd(t.id,t.duration,t.width,t.height),e.mdiaMP4(t))}},{key:"mdiaMP4",value:function(t){return e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minfMP4(t))}},{key:"minfMP4",value:function(t){return e.box(e.types.minf,t.type===wt.VIDEO?e.VMHD:e.SMHD,e.DINF,e.stblMP4(t))}},{key:"stblMP4",value:function(t){var r=t.ext,n=[e.stsd(t),e.stts(r.stts),e.stsc(r.stsc),e.stsz(r.stsz),e.stco(r.stco)];return r.stss.length&&n.push(e.stss(r.stss)),r.ctts.length&&n.push(e.ctts(r.ctts)),e.box.apply(e,[e.types.stbl].concat(n))}},{key:"stts",value:function(t){var r=t.length,n=new Uint8Array(8*r),i=0;return t.forEach((function(e){var t=e.value,r=e.count;n.set([r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t],i),i+=8})),e.box(e.types.stts,Qt(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stsc",value:function(t){var r=t.length,n=new Uint8Array(12*r),i=0;return t.forEach((function(e){var t=e.firstChunk,r=e.samplesPerChunk,a=e.sampleDescIndex;n.set([t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,a>>24,a>>16&255,a>>8&255,255&a],i),i+=12})),e.box(e.types.stsc,Qt(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stsz",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stsz,Qt(new Uint8Array([0,0,0,0,0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stco",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stco,Qt(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stss",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stss,Qt(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"ctts",value:function(t){var r=t.length,n=new Uint8Array(8*r),i=0;return t.forEach((function(e){var t=e.value,r=e.count;n.set([r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t],i),i+=8})),e.box(e.types.ctts,Qt(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"styp",value:function(){return e.box(e.types.styp,new Uint8Array([109,115,100,104,0,0,0,0,109,115,100,104,109,115,105,120]))}},{key:"sidx",value:function(t){var r=t.timescale,n=t.samples[0].duration,i=n*t.samples.length,a=t.samples[0].sampleOffset*n,o=8;t.samples.forEach((function(e){o+=e.size}));var s=0;if(t.isVideo){var u,c=0;t.videoSenc&&(u=t.videoSenc),t.isVideo&&u.forEach((function(e){c+=8,e.subsamples&&e.subsamples.length&&(c+=2,c+=6*e.subsamples.length)})),t.videoSencLength=c,s=o+141+16*t.samples.length+c,t.useEME&&t.isAudioEncryption&&!t.isVideoEncryption&&(s=o+16*t.samples.length+84)}else s=o+116+12*t.samples.length,t.useEME&&t.isAudioEncryption&&(s=o+169+12*t.samples.length+8*t.audioSenc.length);var l=new Uint8Array([0,0,0,0,0,0,0,255&t.id,r>>24&255,r>>16&255,r>>8&255,255&r,a>>24&255,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,1,0,s>>16&255,s>>8&255,255&s,i>>24&255,i>>16&255,i>>8&255,255&i,144,0,0,0]);return e.box(e.types.sidx,l)}},{key:"mdat",value:function(t){var r=e.box(e.types.mdat,t);return r}}]),e}();nt(hr,"types",["avc1","avcC","hvc1","hvcC","dinf","dref","esds","ftyp","hdlr","mdat","mdhd","mdia","mfhd","minf","moof","moov","mp4a","mvex","mvhd","pasp","stbl","stco","stsc","stsd","stsz","stts","tfdt","tfhd","traf","trak","trex","tkhd","vmhd","smhd","ctts","stss","styp","pssh","sidx","sbgp","saiz","saio","senc","trun","encv","enca","sinf","btrt","frma","tenc","schm","schi","mehd","fiel","sdtp"].reduce((function(e,t){return e[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)],e}),Object.create(null))),nt(hr,"HDLR_TYPES",{video:new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])}),nt(hr,"FTYPAVC1",hr.box(hr.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]))),nt(hr,"FTYPHEV1",hr.box(hr.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,104,101,118,49]))),nt(hr,"DINF",hr.box(hr.types.dinf,hr.box(hr.types.dref,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])))),nt(hr,"VMHD",hr.box(hr.types.vmhd,new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))),nt(hr,"SMHD",hr.box(hr.types.smhd,new Uint8Array([0,0,0,0,0,0,0,0]))),nt(hr,"StblTable",new Uint8Array([0,0,0,0,0,0,0,0])),nt(hr,"STTS",hr.box(hr.types.stts,hr.StblTable)),nt(hr,"STSC",hr.box(hr.types.stsc,hr.StblTable)),nt(hr,"STSZ",hr.box(hr.types.stsz,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]))),nt(hr,"STCO",hr.box(hr.types.stco,hr.StblTable));var dr=function(){function e(t,r){et(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]"),e.disabled=r}return rt(e,[{key:"debug",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).debug.apply(t,[this._prefix].concat(n))}}},{key:"log",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).log.apply(t,[this._prefix].concat(n))}}},{key:"warn",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).warn.apply(t,[this._prefix].concat(n))}}},{key:"error",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).error.apply(t,[this._prefix].concat(n))}}},{key:"table",value:function(){var t;e.disabled||(t=console).table.apply(t,arguments)}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();nt(dr,"disabled",!0);var fr=function(){function e(t,r,n){et(this,e),this.videoTrack=t,this.audioTrack=r;var i=/Chrome\/([^.]+)/.exec(navigator.userAgent);this.forceFirstIDR=i&&Number(i[1])<50,this.log=new dr("FMP4Remuxer",!n||!n.openLog||!n.openLog)}return rt(e,[{key:"remux",value:function(){var e,t,r,n,i,a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=this.videoTrack,u=this.audioTrack,c=s.exist(),l=u.exist(),h=[];return a&&(o&&o.initMerge?(c&&h.push(this.videoTrack),l&&h.push(this.audioTrack),r=hr.initSegment(h)):(c&&(e=hr.initSegment([this.videoTrack])),l&&(t=hr.initSegment([this.audioTrack])))),c&&s.hasSample()&&(n=this._remuxVideo()),l&&u.hasSample()&&(i=this._remuxAudio()),s.samples=[],u.samples=[],{initSegment:r,videoInitSegment:e,audioInitSegment:t,videoSegment:n,audioSegment:i}}},{key:"_remuxVideo",value:function(){var e=this.videoTrack;this.forceFirstIDR&&(e.samples[0].flag={dependsOn:2,isNonSyncSample:0});var t=e.samples,r=0;t.forEach((function(e){r+=e.units.reduce((function(e,t){return e+t.byteLength}),0),r+=4*e.units.length}));for(var n,i=new Uint8Array(r),a=new DataView(i.buffer),o=function(e,r){r=t[s];var o=0;r.units.forEach((function(t){a.setUint32(e,t.byteLength),e+=4,i.set(t,e),e+=t.byteLength,o+=4+t.byteLength})),r.size=o,c=e,n=r},s=0,u=t.length,c=0;s<u;s++)o(c,n);var l=hr.mdat(i),h=hr.moof([e]);return Qt(h,l)}},{key:"_remuxAudio",value:function(){var e=this.audioTrack,t=new Uint8Array(e.samples.reduce((function(e,t){return e+t.size}),0));e.samples.reduce((function(e,r){return t.set(r.data,e),e+r.size}),0);var r=hr.mdat(t),n=hr.moof([e]);return Qt(n,r)}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset()}}]),e}(),pr=new le("BufferService"),vr=function(){function e(t,r,n){d(this,e),v(this,"flv",null),v(this,"_demuxer",new sr),v(this,"_remuxer",null),v(this,"_mse",null),v(this,"_softVideo",null),v(this,"_sourceCreated",!1),v(this,"_needInitSegment",!0),v(this,"_discontinuity",!0),v(this,"_contiguous",!1),v(this,"_initSegmentId",""),v(this,"_cachedBuffer",null),v(this,"_demuxStartTime",0),v(this,"_opts",null),this.flv=t,this._opts=n,r?this._softVideo=r:(this._remuxer=new fr(this._demuxer.videoTrack,this._demuxer.audioTrack),this._mse=new Ze,this._mse.bindMedia(t.media))}return p(e,[{key:"baseDts",get:function(){var e,t;return null===(e=this._demuxer)||void 0===e||null===(t=e._fixer)||void 0===t?void 0:t._baseDts}},{key:"seamlessSwitch",value:function(){this._needInitSegment=!0,this._discontinuity=!0,this._contiguous=!0,this._initSegmentId=""}},{key:"unContiguous",value:function(e){this._contiguous=!1,this._demuxStartTime=e}},{key:"reset",value:function(){var e=h(c().mark((function e(){var t,r=arguments;return c().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]&&r[0],!this._mse||t){e.next=6;break}return e.next=4,this._mse.unbindMedia();case 4:return e.next=6,this._mse.bindMedia(this.flv.media);case 6:this._needInitSegment=!0,this._discontinuity=!0,this._contiguous=!1,this._sourceCreated=!1,this._initSegmentId="";case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"endOfStream",value:function(){var e=h(c().mark((function e(){return c().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this._mse){e.next=7;break}if(!this._sourceCreated){e.next=5;break}return e.next=4,this._mse.endOfStream();case 4:this.flv.emit(D.BUFFEREOS);case 5:e.next=8;break;case 7:this._softVideo&&this._softVideo.endOfStream();case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"updateDuration",value:function(){var e=h(c().mark((function e(t){return c().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this._mse){e.next=7;break}if(this._mse.isOpened){e.next=4;break}return e.next=4,this._mse.open();case 4:return pr.debug("update duration",t),e.next=7,this._mse.updateDuration(t);case 7:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var e=h(c().mark((function e(){return c().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this._mse){e.next=3;break}return e.next=3,this._mse.unbindMedia();case 3:this._mse=null,this._softVideo=null,this._demuxer=null,this._remuxer=null;case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"appendBuffer",value:function(){var e=h(c().mark((function e(t){var r,n,i,a,o,s,u,l,h,d,f,p,v,_;return c().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this._cachedBuffer&&(t=be(this._cachedBuffer,t),this._cachedBuffer=null),r=this._demuxer,t&&t.length&&r){e.next=4;break}return e.abrupt("return");case 4:e.prev=4,r.demuxAndFix(t,this._discontinuity,this._contiguous,this._demuxStartTime),e.next=11;break;case 8:throw e.prev=8,e.t0=e["catch"](4),new _e(pe.DEMUX,pe.SUB_TYPES.FLV,e.t0);case 11:if(n=r.videoTrack,i=r.audioTrack,a=r.metadataTrack,o=n.exist(),s=i.exist(),this._opts.onlyAudio&&(o=!1,n.present=!1),this._opts.onlyVideo&&(s=!1,i.present=!1),!(!o&&n.present||!s&&i.present)){e.next=29;break}if(u=0,l=o?n:s?i:void 0,l&&l.samples.length&&(u=(l.samples[l.samples.length-1].originPts-l.samples[0].originPts)/l.timescale*1e3),!(u>this._opts.analyzeDuration)){e.next=27;break}pr.warn("analyze duration exceeded, ".concat(u,"ms"),l),n.present=o,i.present=s,this.flv.emit(D.ANALYZE_DURATION_EXCEEDED,{duration:u}),e.next=29;break;case 27:return this._cachedBuffer=t,e.abrupt("return");case 29:if(h=n.type,d=i.type,this._fireEvents(n,i,a),this._discontinuity=!1,this._contiguous=!0,this._demuxStartTime=0,f=this._mse,this.flv.emit(D.DEMUXED_TRACK,{videoTrack:n}),p="".concat(n.codec,"/").concat(n.width,"/").concat(n.height,"/").concat(i.codec,"/").concat(i.config),p!==this._initSegmentId&&(this._needInitSegment=!0,this._initSegmentId=p,this._emitMetaParsedEvent(n,i)),!f){e.next=65;break}if(this._sourceCreated){e.next=47;break}return e.next=43,f.open();case 43:o&&(pr.log("codec: video/mp4;codecs=".concat(n.codec)),f.createSource(h,"video/mp4;codecs=".concat(n.codec))),s&&(pr.log("codec: audio/mp4;codecs=".concat(i.codec)),f.createSource(d,"audio/mp4;codecs=".concat(i.codec))),this._sourceCreated=!0,this.flv.emit(D.SOURCEBUFFER_CREATED);case 47:e.prev=47,v=this._remuxer.remux(this._needInitSegment),e.next=54;break;case 51:throw e.prev=51,e.t1=e["catch"](47),new _e(pe.REMUX,pe.SUB_TYPES.FMP4,e.t1);case 54:if(!this._needInitSegment||v.videoInitSegment||v.audioInitSegment){e.next=56;break}return e.abrupt("return");case 56:return this._needInitSegment=!1,_=[],v.videoInitSegment&&_.push(f.append(h,v.videoInitSegment)),v.audioInitSegment&&_.push(f.append(d,v.audioInitSegment)),v.videoSegment&&_.push(f.append(h,v.videoSegment)),v.audioSegment&&_.push(f.append(d,v.audioSegment)),e.abrupt("return",Promise.all(_));case 65:this._softVideo&&this._softVideo.appendBuffer(n,i);case 66:case"end":return e.stop()}}),e,this,[[4,8],[47,51]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"evictBuffer",value:function(){var e=h(c().mark((function e(t){var r,n,i,a,o=this;return c().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=this.flv.media,this._mse&&this._demuxer&&r&&t&&!(t<0)){e.next=3;break}return e.abrupt("return");case 3:if(n=r.currentTime,i=n-t,!(i<=0)){e.next=7;break}return e.abrupt("return");case 7:if(a=ye.start(ye.get(r)),!(a+1>=i)){e.next=10;break}return e.abrupt("return");case 10:return e.abrupt("return",this._mse.clearBuffer(0,i).then((function(){return o.flv.emit(D.REMOVE_BUFFER,{removeEnd:i})})));case 11:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_emitMetaParsedEvent",value:function(e,t){e.exist()&&this.flv.emit(D.METADATA_PARSED,{type:"video",track:e,meta:{codec:e.codec,timescale:e.timescale,width:e.width,height:e.height,sarRatio:e.sarRatio,baseDts:e.baseDts}}),t.exist()&&this.flv.emit(D.METADATA_PARSED,{type:"audio",track:t,meta:{codec:t.codec,channelCount:t.channelCount,sampleRate:t.sampleRate,timescale:t.timescale,baseDts:t.baseDts}}),pr.debug("track parsed",e,t)}},{key:"_fireEvents",value:function(e,t,r){var n=this;pr.debug(e.samples,t.samples),r.flvScriptSamples.forEach((function(e){n.flv.emit(D.FLV_SCRIPT_DATA,e),pr.debug("flvScriptData",e)})),e.samples.forEach((function(e){e.keyframe&&n.flv.emit(D.KEYFRAME,{pts:e.pts})})),e.warnings.forEach((function(e){var t;switch(e.type){case xt.LARGE_AV_SHIFT:t=D.LARGE_AV_FIRST_FRAME_GAP_DETECT;break;case xt.LARGE_VIDEO_GAP:t=D.LARGE_VIDEO_DTS_GAP_DETECT;break;case xt.LARGE_VIDEO_GAP_BETWEEN_CHUNK:t=D.MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT;break}t&&n.flv.emit(D.STREAM_EXCEPTION,u(u({},e),{},{type:t})),pr.warn("video exception",e)})),t.warnings.forEach((function(e){var t;switch(e.type){case xt.LARGE_AUDIO_GAP:t=D.LARGE_AUDIO_DTS_GAP_DETECT;break;case xt.AUDIO_FILLED:t=D.AUDIO_GAP_DETECT;break;case xt.AUDIO_DROPPED:t=D.AUDIO_OVERLAP_DETECT;break}t&&n.flv.emit(D.STREAM_EXCEPTION,u(u({},e),{},{type:t})),pr.warn("audio exception",e)})),r.seiSamples.forEach((function(e){n.flv.emit(D.SEI,u(u({},e),{},{sei:{code:e.data.type,content:e.data.payload,dts:e.pts}}))}))}}]),e}();function _r(e){var t=u({retryCount:3,retryDelay:1e3,loadTimeout:1e4,maxReaderInterval:5e3,preloadTime:5,isLive:!1,softDecode:!1,bufferBehind:10,maxJumpDistance:3,analyzeDuration:2e4,seamlesslyReload:!1,keepStatusAfterSwitch:!0,onlyVideo:!1,onlyAudio:!1},e);return t.isLive&&t.preloadTime&&(t.maxLatency||(t.maxLatency=2*t.preloadTime),t.targetLatency||(t.targetLatency=t.preloadTime),null!==t.disconnectTime&&void 0!==t.disconnectTime||(t.disconnectTime=t.maxLatency)),t}function yr(e,t){var r=0,n=e.length-1,i=0,a=0,o=n;t<e[0]&&(r=0,a=o+1);while(a<=o){if(i=a+Math.floor((o-a)/2),i===n||t>=e[i]&&t<e[i+1]){r=i;break}e[i]<t?a=i+1:o=i-1}return r}var mr=new le("flv"),gr=function(e){_(r,e);var t=k(r);function r(e){var n;return d(this,r),n=t.call(this),v(b(n),"media",null),v(b(n),"_loading",!1),v(b(n),"_opts",null),v(b(n),"_bufferService",null),v(b(n),"_gapService",null),v(b(n),"_stats",null),v(b(n),"_mediaLoader",null),v(b(n),"_maxChunkWaitTimer",null),v(b(n),"_tickTimer",null),v(b(n),"_tickInterval",500),v(b(n),"_urlSwitching",!1),v(b(n),"_seamlessSwitching",!1),v(b(n),"_keyframes",null),v(b(n),"_acceptRanges",!0),v(b(n),"_onProgress",function(){var e=h(c().mark((function e(t,r,i,a){var o,s,u,l,h,d,f,p;return c().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(o=i.startTime,s=i.endTime,u=i.st,l=i.firstByteTime,n._loading=!r,n._firstProgressEmit){e.next=11;break}if(n.media){e.next=6;break}return null===(h=n._mediaLoader)||void 0===h||h.cancel(),e.abrupt("return");case 6:d=a.headers,n.emit(D.TTFB,{url:n._opts.url,responseUrl:a.url,elapsed:u?l-u:s-o}),n.emit(D.LOAD_RESPONSE_HEADERS,{headers:d}),n._acceptRanges=!(null===d||void 0===d||!d.get("Accept-Ranges"))||!(null===d||void 0===d||!d.get("Content-Range")),n._firstProgressEmit=!0;case 11:if(n._bufferService){e.next=13;break}return e.abrupt("return");case 13:return clearTimeout(n._maxChunkWaitTimer),n._bandwidthService.addChunkRecord(null===t||void 0===t?void 0:t.byteLength,s-o),e.prev=15,e.next=18,n._bufferService.appendBuffer(t);case 18:n.isLive&&(null===(f=n._bufferService)||void 0===f||f.evictBuffer(n._opts.bufferBehind)),e.next=24;break;case 21:return e.prev=21,e.t0=e["catch"](15),e.abrupt("return",n._emitError(_e.create(e.t0)));case 24:if(n._urlSwitching&&(n._urlSwitching=!1,n.emit(D.SWITCH_URL_SUCCESS,{url:n._opts.url})),n._seamlessSwitching&&(n._seamlessSwitching=!1,n._tick()),!r||n.media.seeking){e.next=32;break}return n.emit(D.LOAD_COMPLETE),mr.debug("load done"),e.abrupt("return",n._end());case 32:p=n._opts.maxReaderInterval,p&&(clearTimeout(n._maxChunkWaitTimer),n._maxChunkWaitTimer=setTimeout((function(){mr.debug("onMaxChunkWait",p),n._end()}),p));case 34:case"end":return e.stop()}}),e,null,[[15,21]])})));return function(t,r,n,i){return e.apply(this,arguments)}}()),v(b(n),"_onRetryError",(function(e,t){mr.debug("load retry",e,t),n.emit(D.LOAD_RETRY,{error:_e.network(e),retryTime:t})})),v(b(n),"_end",(function(){n._clear(),n._bufferService&&n._bufferService.endOfStream(),mr.debug("end stream")})),v(b(n),"_tick",(function(){clearTimeout(n._tickTimer);var e=b(n),t=e.media;if(t){n._tickTimer=setTimeout(n._tick,n._tickInterval);var r=ye.end(ye.get(t));if(!(r<.1)&&t.readyState){var i=n._opts;if(me(t))n._gapService&&n._gapService.do(t,i.maxJumpDistance,n.isLive,3);else{if(!t.currentTime&&n._gapService)return void n._gapService.do(t,i.maxJumpDistance,n.isLive,3);i.isLive&&r>i.disconnectTime&&n.disconnect()}}}})),v(b(n),"_onPlay",(function(){var e,t,r=n._opts.softDecode||(null===(e=n.media)||void 0===e||null===(t=e.buffered)||void 0===t?void 0:t.length);n.isLive&&!n._loading&&r&&n.replay(void 0,!0)})),v(b(n),"_onSeeking",h(c().mark((function e(){var t,r,i,a,o;return c().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n.isLive||!n.seekable){e.next=14;break}if(t=n._keyframes.times,r=n._keyframes.filepositions,null!==t&&void 0!==t&&t.length&&null!==r&&void 0!==r&&r.length){e.next=5;break}return e.abrupt("return");case 5:if(i=n.media.currentTime,a=yr(n._keyframes.times,i),o=r[a],null!==o&&void 0!==o){e.next=10;break}return e.abrupt("return");case 10:return e.next=12,n._mediaLoader.cancel();case 12:n._loadData(null,[o]),n._bufferService.unContiguous(t[a]);case 14:case"end":return e.stop()}}),e)})))),v(b(n),"_onTimeupdate",(function(){if(n.media){var e=n._opts,t=n.media.currentTime;if(e.isLive&&e.maxLatency&&e.targetLatency){var r=ye.end(ye.get(n.media)),i=r-t;i>=e.maxLatency&&(n.media.currentTime=r-e.targetLatency)}n._seiService.throw(t)}})),v(b(n),"_onFlvScriptData",(function(e){var t,r,i,a,o=null===(t=e.data)||void 0===t||null===(r=t.onMetaData)||void 0===r?void 0:r.keyframes,s=null===(i=e.data)||void 0===i||null===(a=i.onMetaData)||void 0===a?void 0:a.duration;o&&(n._keyframes=o),!n._opts.isLive&&s&&n._bufferService.updateDuration(s)})),n._opts=_r(e),n.media=n._opts.media||document.createElement("video"),n._opts.media=null,n._firstProgressEmit=!1,n._mediaLoader=new Ge(u(u({},n._opts.fetchOptions),{},{retry:n._opts.retryCount,retryDelay:n._opts.retryDelay,timeout:n._opts.loadTimeout,onRetryError:n._onRetryError,onProgress:n._onProgress,responseType:"arraybuffer"})),n._bufferService=new vr(b(n),n._opts.softDecode?n.media:void 0,n._opts),n._seiService=new He(b(n)),n._bandwidthService=new ze,n._stats=new We(b(n)),n._opts.softDecode||(n._gapService=new Ke),n.media.addEventListener("play",n._onPlay),n.media.addEventListener("seeking",n._onSeeking),n.media.addEventListener("timeupdate",n._onTimeupdate),n.on(D.FLV_SCRIPT_DATA,n._onFlvScriptData),n}return p(r,[{key:"version",get:function(){return"3.0.4"}},{key:"isLive",get:function(){return this._opts.isLive}},{key:"baseDts",get:function(){var e;return null===(e=this._bufferService)||void 0===e?void 0:e.baseDts}},{key:"seekable",get:function(){return!!this._keyframes&&this._acceptRanges}},{key:"speedInfo",value:function(){return{speed:this._bandwidthService.getLatestSpeed(),avgSpeed:this._bandwidthService.getAvgSpeed()}}},{key:"getStats",value:function(){return this._stats.getStats()}},{key:"bufferInfo",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1;return ye.info(ye.get(this.media),null===(e=this.media)||void 0===e?void 0:e.currentTime,t)}},{key:"playbackQuality",value:function(){return ge(this.media)}},{key:"load",value:function(){var e=h(c().mark((function e(t){var r,n=arguments;return c().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=n.length>1&&void 0!==n[1]&&n[1],this._bufferService){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this._reset(r);case 5:this._loadData(t),clearTimeout(this._tickTimer),this._tickTimer=setTimeout(this._tick,this._tickInterval);case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"replay",value:function(){var e=h(c().mark((function e(){var t,r,n=this,i=arguments;return c().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:this._opts.seamlesslyReload,r=i.length>1?i[1]:void 0,this.media){e.next=4;break}return e.abrupt("return");case 4:if(!t){e.next=10;break}return e.next=7,this._clear();case 7:setTimeout((function(){n._loadData(n._opts.url),n._bufferService.seamlessSwitch(),n._seamlessSwitching=!0})),e.next=12;break;case 10:return e.next=12,this.load();case 12:return e.abrupt("return",this.media.play(!r).catch((function(){})));case 13:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"disconnect",value:function(){return mr.debug("disconnect!"),this._clear()}},{key:"switchURL",value:function(){var e=h(c().mark((function e(t,r){var n=this;return c().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this._bufferService){e.next=2;break}return e.abrupt("return");case 2:if(r&&this._opts.isLive){e.next=7;break}return e.next=5,this.load(t);case 5:return this._urlSwitching=!0,e.abrupt("return",this.media.play(!0).catch((function(){})));case 7:return e.next=9,this._clear();case 9:setTimeout((function(){n._loadData(t),n._bufferService.seamlessSwitch(),n._urlSwitching=!0,n._seamlessSwitching=!0}));case 10:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var e=h(c().mark((function e(){return c().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.media){e.next=2;break}return e.abrupt("return");case 2:return this.removeAllListeners(),this._seiService.reset(),this.media.removeEventListener("play",this._onPlay),this.media.removeEventListener("seeking",this._onSeeking),this.media.removeEventListener("timeupdate",this._onTimeupdate),e.next=9,Promise.all([this._clear(),this._bufferService.destroy()]);case 9:this.media=null,this._bufferService=null;case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"_emitError",value:function(e){var t,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];mr.table(e),mr.error(e),mr.error(null===(t=this.media)||void 0===t?void 0:t.error),this._urlSwitching&&(this._urlSwitching=!1,this._seamlessSwitching=!1,this.emit(D.SWITCH_URL_FAILED,e)),this.emit(D.ERROR,e),r&&(this._seiService.reset(),this._end())}},{key:"_reset",value:function(){var e=h(c().mark((function e(){var t,r=arguments;return c().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]&&r[0],this._seiService.reset(),this._bandwidthService.reset(),this._stats.reset(),e.next=6,this._clear();case 6:return e.next=8,this._bufferService.reset(t);case 8:this._firstProgressEmit=!1;case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"_loadData",value:function(){var e=h(c().mark((function e(t,r){return c().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t&&(this._opts.url=t),t=this._opts.url,t){e.next=4;break}throw new Error("Source url is missing");case 4:if(this.emit(D.LOAD_START,{url:t}),mr.debug("load data, loading:",this._loading,t),!this._loading){e.next=9;break}return e.next=9,this._mediaLoader.cancel();case 9:return this._loading=!0,e.prev=10,e.next=13,this._mediaLoader.load({url:t,range:r});case 13:e.next=18;break;case 15:return e.prev=15,e.t0=e["catch"](10),e.abrupt("return",this._emitError(_e.network(e.t0)));case 18:case"end":return e.stop()}}),e,this,[[10,15]])})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"_clear",value:function(){var e=h(c().mark((function e(){return c().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(clearTimeout(this._maxChunkWaitTimer),clearTimeout(this._tickTimer),!this._mediaLoader){e.next=5;break}return e.next=5,this._mediaLoader.cancel();case 5:this._loading=!1;case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}],[{key:"isSupported",value:function(e){return e&&"video"!==e&&"audio"!==e?"undefined"!==typeof WebAssembly:Ze.isSupported()}},{key:"enableLogger",value:function(){le.enable(),kt.enable()}},{key:"disableLogger",value:function(){le.disable(),kt.disable()}}]),r}(R.a);try{localStorage.getItem("xgd")?gr.enableLogger():gr.disableLogger()}catch(xr){}var br=function(){function e(t,r){var n=this;d(this,e),v(this,"_onLowDecode",(function(){var e,t,r,i,a=n._opts,o=a.media,s=a.innerDegrade,c=a.backupURL;null===(e=n._plugin)||void 0===e||null===(t=e.player)||void 0===t||t.emit("lowdecode",o.degradeInfo),null===(r=n._plugin)||void 0===r||null===(i=r.player)||void 0===i||i.emit("core_event",u(u({},o.degradeInfo),{},{eventName:D.LOWDECODE})),1!==s&&3!==s||!c||n._degrade(c)})),v(this,"_degrade",(function(e){var t=n._plugin.player,r=t.video;if("MVideo"===(null===r||void 0===r?void 0:r.TAG)){var i=t.video.degradeVideo;t.video=i,r.degrade(e),e&&(t.config.url=e);var a=t.root.firstChild;"MVideo"===a.TAG&&t.root.replaceChild(i,a);var o=n._plugin.constructor.pluginName.toLowerCase();t.unRegisterPlugin(o),t.once("canplay",(function(){t.play()}))}})),v(this,"forceDegradeToVideo",(function(e){var t=n._opts.innerDegrade;1!==t&&3!==t||n._degrade(e)})),this._opts=t,this._plugin=r,this._init()}return p(e,[{key:"_init",value:function(){var e=this._opts,t=e.media,r=e.preloadTime,n=e.innerDegrade,i=e.decodeMode;t&&(n&&t.setAttribute("innerdegrade",n),r&&t.setAttribute("preloadtime",r),t.setDecodeMode&&t.setDecodeMode(i),this._bindEvents())}},{key:"_bindEvents",value:function(){var e=this._opts.media;e.addEventListener("lowdecode",this._onLowDecode)}},{key:"destroy",value:function(){var e,t;null===(e=this._opts)||void 0===e||null===(t=e.media)||void 0===t||t.removeEventListener("lowdecode",this._onLowDecode),this._plugin=null}}]),e}(),Er=function(e){_(r,e);var t=k(r);function r(){var e;d(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),v(b(e),"flv",null),v(b(e),"pluginExtension",null),v(b(e),"getStats",(function(){var t;return null===(t=e.flv)||void 0===t?void 0:t.getStats()})),v(b(e),"destroy",(function(){var t;e.flv&&(e.flv.destroy(),e.flv=null),null===(t=e.pluginExtension)||void 0===t||t.destroy(),e.pluginExtension=null})),v(b(e),"_onSwitchURL",(function(t,r){var n,i;e.flv&&(e.player.config.url=t,e.flv.switchURL(t,r),!r&&null!==(n=e.player.config)&&void 0!==n&&null!==(i=n.flv)&&void 0!==i&&i.keepStatusAfterSwitch&&e._keepPauseStatus())})),v(b(e),"_keepPauseStatus",(function(){var t=e.player.paused;t&&e.player.once("canplay",(function(){e.player.pause()}))})),v(b(e),"_onDefinitionChange",(function(t){var r=t.to;e.flv&&e.flv.switchURL(r)})),e}return p(r,[{key:"core",get:function(){return this.flv}},{key:"version",get:function(){var e;return null===(e=this.flv)||void 0===e?void 0:e.version}},{key:"softDecode",get:function(){var e,t,r=null===(e=this.player)||void 0===e||null===(t=e.config)||void 0===t?void 0:t.mediaType;return!!r&&"video"!==r&&"audio"!==r}},{key:"beforePlayerInit",value:function(){var e=this,t=this.player.config;if(t.url){this.flv&&this.flv.destroy(),this.player.switchURL=this._onSwitchURL;var r,n=t.flv||{};if(null!==n.disconnectTime&&void 0!==n.disconnectTime||(n.disconnectTime=0),this.flv=new gr(u({softDecode:this.softDecode,isLive:t.isLive,media:this.player.video},n)),this.softDecode||T["a"].defineGetterOrSetter(this.player,{url:{get:function(){var t,r;return null===(t=e.flv)||void 0===t||null===(r=t.media)||void 0===r?void 0:r.src},configurable:!0}}),this.softDecode&&(this.pluginExtension=new br(u({media:this.player.video},t.flv),this),this.player.forceDegradeToVideo=function(){for(var t,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return null===(t=e.pluginExtension)||void 0===t?void 0:t.forceDegradeToVideo.apply(t,n)}),t.isLive)null===(r=this.player)||void 0===r||r.useHooks("replay",(function(){var t;return null===(t=e.flv)||void 0===t?void 0:t.replay()}));this.on(x["a"].URL_CHANGE,this._onSwitchURL),this.on(x["a"].DESTROY,this.destroy),this._transError(),this._transCoreEvent(D.TTFB),this._transCoreEvent(D.LOAD_START),this._transCoreEvent(D.LOAD_RESPONSE_HEADERS),this._transCoreEvent(D.LOAD_COMPLETE),this._transCoreEvent(D.LOAD_RETRY),this._transCoreEvent(D.SOURCEBUFFER_CREATED),this._transCoreEvent(D.ANALYZE_DURATION_EXCEEDED),this._transCoreEvent(D.REMOVE_BUFFER),this._transCoreEvent(D.BUFFEREOS),this._transCoreEvent(D.KEYFRAME),this._transCoreEvent(D.METADATA_PARSED),this._transCoreEvent(D.SEI),this._transCoreEvent(D.SEI_IN_TIME),this._transCoreEvent(D.FLV_SCRIPT_DATA),this._transCoreEvent(D.STREAM_EXCEPTION),this._transCoreEvent(D.SWITCH_URL_SUCCESS),this._transCoreEvent(D.SWITCH_URL_FAILED),this.flv.load(t.url,!0)}}},{key:"_transError",value:function(){var e=this;this.flv.on(D.ERROR,(function(t){e.player&&e.player.emit(x["a"].ERROR,new A["b"](e.player,t))}))}},{key:"_transCoreEvent",value:function(e){var t=this;this.flv.on(e,(function(r){t.player&&t.player.emit("core_event",u(u({},r),{},{eventName:e}))}))}}],[{key:"pluginName",get:function(){return"flv"}},{key:"isSupported",value:function(e,t){return gr.isSupported(e,t)}}]),r}(T["a"]);v(Er,"Flv",gr);var kr={data(){return{videoPlayer:null,url3:"https://sf1-hscdn-tos.pstatp.com/obj/media-fe/xgplayer_doc_video/flv/xgplayer-demo-360p.flv"}},mounted(){this.getVideo()},methods:{getVideo(){this.videoPlayer=new o["a"]({id:"mmid",isLive:!0,plugins:[Er],url:this.url3,width:"600px",height:"440px",volume:.6,autoplay:!0,playsinline:!0,cors:!0})}}},wr=r("6b0d"),Sr=r.n(wr);const Tr=Sr()(kr,[["render",a]]);t["default"]=Tr}}]);